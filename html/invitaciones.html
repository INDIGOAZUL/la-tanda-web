<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- Resource Optimization -->
    <!-- DNS Prefetch for external resources -->
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <!-- Preconnect to critical origins -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invitaciones | La Tanda Web3</title>
    <!-- Critical CSS: Font Awesome with async loading -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel=stylesheet">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Optimized Google Fonts loading -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" as="style" onload="this.onload=null;this.rel=stylesheet">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"></noscript>
    <style>
        /* ================================
           üåê WEB3 DESIGN SYSTEM
           ================================ */
        :root {
            /* La Tanda Web3 Colors */
            --tanda-cyan: #00FFFF;
            --tanda-cyan-light: #7FFFD8;
            --tanda-cyan-dark: #00E5E5;
            --tanda-black: #000000;
            --text-primary: #f8fafc;
            --text-secondary: rgba(248, 250, 252, 0.7);
            --text-accent: #00FFFF;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: rgba(15, 23, 42, 0.6);
            --border-card: rgba(0, 255, 255, 0.1);
            --border-accent: rgba(0, 255, 255, 0.2);
            --crypto-gold: #ffd700;
            --success-color: #22d55e;
            --warning-color: #fbbf24;
            --error-color: #f87171;
            --info-color: #3b82f6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }
        
        /* ================================
           ‚ú® BACKGROUND EFFECTS
           ================================ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 255, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(255, 215, 0, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* ================================
           üß≠ NAVIGATION
           ================================ */
        .nav-header {
            background: var(--bg-card);
            backdrop-filter: blur(24px);
            border: 1px solid var(--border-accent);
            border-radius: 16px;
            padding: 20px 24px;
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .back-btn {
            background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
            color: var(--tanda-black);
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }
        
        .nav-links {
            display: flex;
            gap: 16px;
        }
        
        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .nav-link:hover {
            color: var(--tanda-cyan);
            background: rgba(0, 255, 255, 0.1);
            border-color: var(--border-accent);
        }
        
        /* ================================
           üìä MAIN CONTAINER
           ================================ */
        .invitations-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        /* ================================
           üìß INVITATION TABS
           ================================ */
        .invitation-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
            background: var(--bg-card);
            backdrop-filter: blur(24px);
            border: 1px solid var(--border-card);
            border-radius: 16px;
            padding: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .tab-btn {
            flex: 1;
            padding: 16px 20px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .tab-btn:hover {
            background: rgba(0, 255, 255, 0.1);
            color: var(--text-primary);
            border-color: var(--border-accent);
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(0, 255, 255, 0.1));
            color: var(--tanda-cyan);
            border-color: var(--tanda-cyan);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.2);
        }
        
        /* ================================
           üìã INVITATION SECTIONS
           ================================ */
        .invitation-section {
            background: var(--bg-card);
            backdrop-filter: blur(24px);
            border: 1px solid var(--border-card);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: none;
        }
        
        .invitation-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-card);
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .invitation-count {
            background: rgba(0, 255, 255, 0.2);
            color: var(--tanda-cyan);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* ================================
           ‚úâÔ∏è INVITATION CARDS
           ================================ */
        .invitation-card {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .invitation-card:hover {
            background: rgba(0, 0, 0, 0.5);
            border-color: var(--border-accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        
        .invitation-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .invitation-info {
            flex: 1;
        }
        
        .invitation-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .invitation-meta {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }
        
        .invitation-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 16px;
        }
        
        .invitation-status {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pending {
            background: rgba(251, 191, 36, 0.2);
            color: var(--warning-color);
        }
        
        .status-accepted {
            background: rgba(34, 213, 94, 0.2);
            color: var(--success-color);
        }
        
        .status-declined {
            background: rgba(248, 113, 113, 0.2);
            color: var(--error-color);
        }
        
        .status-sent {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info-color);
        }
        
        .invitation-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }
        
        .btn-action {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-accept {
            background: linear-gradient(135deg, var(--success-color), #16a34a);
            color: white;
        }
        
        .btn-accept:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(34, 213, 94, 0.3);
        }
        
        .btn-decline {
            background: transparent;
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }
        
        .btn-decline:hover {
            background: var(--error-color);
            color: white;
        }
        
        .btn-view {
            background: transparent;
            color: var(--tanda-cyan);
            border: 1px solid var(--tanda-cyan);
        }
        
        .btn-view:hover {
            background: var(--tanda-cyan);
            color: var(--tanda-black);
        }
        
        .btn-resend {
            background: linear-gradient(135deg, var(--info-color), #1d4ed8);
            color: white;
        }
        
        .btn-resend:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        /* ================================
           ‚ûï CREATE INVITATION
           ================================ */
        .create-invitation {
            background: var(--bg-card);
            backdrop-filter: blur(24px);
            border: 1px solid var(--border-card);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-card);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--tanda-cyan);
            box-shadow: 0 0 0 2px rgba(0, 255, 255, 0.2);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
            color: var(--tanda-black);
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
        }
        
        /* ================================
           üì± RESPONSIVE DESIGN
           ================================ */
        @media (max-width: 768px) {
            body {
                padding: 16px;
            }
            
            .nav-header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            .nav-left {
                flex-direction: column;
                gap: 12px;
            }
            
            .invitation-tabs {
                flex-direction: column;
                gap: 8px;
            }
            
            .tab-btn {
                padding: 12px 16px;
            }
            
            .invitation-header {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }
            
            .invitation-actions {
                flex-wrap: wrap;
            }
            
            .btn-action {
                flex: 1;
                justify-content: center;
                min-width: 120px;
            }
        }
        
        /* ================================
           ‚ú® ANIMATIONS
           ================================ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .invitation-card {
            animation: fadeIn 0.3s ease;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }
        
        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .empty-description {
            font-size: 14px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <nav class="nav-header">
        <div class="nav-left">
            <button class="back-btn" onclick="window.location.href='home-dashboard.html'">
                <i class="fas fa-arrow-left"></i> Dashboard
            </button>
            <h1 class="page-title">
                <i class="fas fa-envelope"></i> Invitaciones
            </h1>
        </div>
        <div class="nav-links">
            <a href="groups-advanced-system.html" class="nav-link">
                <i class="fas fa-users"></i> Grupos
            </a>
            <a href="tanda-wallet.html" class="nav-link">
                <i class="fas fa-wallet"></i> Wallet
            </a>
            <a href="web3-dashboard.html" class="nav-link">
                <i class="fas fa-chart-line"></i> Trading
            </a>
        </div>
    </nav>

    <div class="invitations-container">
        <!-- Invitation Tabs -->
        <div class="invitation-tabs">
            <button class="tab-btn active" onclick="switchTab('received')">
                <i class="fas fa-inbox"></i> Recibidas <span class="invitation-count" id="receivedCount">0</span>
            </button>
            <button class="tab-btn" onclick="switchTab('sent')">
                <i class="fas fa-paper-plane"></i> Enviadas <span class="invitation-count" id="sentCount">0</span>
            </button>
            <button class="tab-btn" onclick="switchTab('create')">
                <i class="fas fa-plus"></i> Nueva Invitaci√≥n
            </button>
        </div>

        <!-- Received Invitations Section -->
        <div id="received-section" class="invitation-section active">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-inbox"></i> Invitaciones Recibidas
                </h2>
            </div>
            <div id="receivedInvitations">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>

        <!-- Sent Invitations Section -->
        <div id="sent-section" class="invitation-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-paper-plane"></i> Invitaciones Enviadas
                </h2>
            </div>
            <div id="sentInvitations">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>

        <!-- Create Invitation Section -->
        <div id="create-section" class="invitation-section">
            <div class="create-invitation">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-plus"></i> Nueva Invitaci√≥n
                    </h2>
                </div>
                
                <form id="invitationForm">
                    <div class="form-group">
                        <label class="form-label">Tipo de Invitaci√≥n</label>
                        <select class="form-select" id="invitationType" required>
                            <option value="">Seleccionar tipo</option>
                            <option value="group">Unirse a Grupo</option>
                            <option value="tanda">Participar en Tanda</option>
                            <option value="referral">Referir Usuario</option>
                            <option value="collaboration">Colaboraci√≥n</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email del Destinatario</label>
                        <input type="email" class="form-input" id="recipientEmail" placeholder="ejemplo@correo.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Nombre del Destinatario</label>
                        <input type="text" class="form-input" id="recipientName" placeholder="Nombre completo" required>
                    </div>
                    
                    <div class="form-group" id="groupSelection" style="display: none;">
                        <label class="form-label">Seleccionar Grupo/Tanda</label>
                        <select class="form-select" id="targetGroup">
                            <option value="">Seleccionar grupo</option>
                            <option value="group1">Tanda Ahorro Familiar - $500</option>
                            <option value="group2">Grupo Emprendedores - $1000</option>
                            <option value="group3">Tanda Estudiantil - $200</option>
                            <option value="group4">Inversi√≥n Colectiva - $2000</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Mensaje Personal (Opcional)</label>
                        <textarea class="form-textarea" id="personalMessage" placeholder="Escribe un mensaje personalizado para el destinatario..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Fecha de Expiraci√≥n</label>
                        <input type="date" class="form-input" id="expirationDate" required>
                    </div>
                    
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-paper-plane"></i> Enviar Invitaci√≥n
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Invitation Manager Class
        class InvitationManager {
            constructor() {
                this.receivedInvitations = [];
                this.sentInvitations = [];
                this.currentTab = 'received';
                this.init();
            }

            init() {
                this.loadInvitations();
                this.setupEventListeners();
                this.setDefaultExpirationDate();
            }

            setDefaultExpirationDate() {
                const today = new Date();
                const oneWeekLater = new Date(today.getTime() + (7 * 24 * 60 * 60 * 1000));
                document.getElementById('expirationDate').value = oneWeekLater.toISOString().split('T')[0];
            }

            setupEventListeners() {
                // Form submission
                document.getElementById('invitationForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.createInvitation();
                });

                // Invitation type change
                document.getElementById('invitationType').addEventListener('change', (e) => {
                    const groupSelection = document.getElementById('groupSelection');
                    if (e.target.value === 'group' || e.target.value === 'tanda') {
                        groupSelection.style.display = 'block';
                    } else {
                        groupSelection.style.display = 'none';
                    }
                });
            }

            loadInvitations() {
                try {
                    // Load from localStorage or generate demo data
                    const cachedReceived = localStorage.getItem('latanda_received_invitations');
                    const cachedSent = localStorage.getItem('latanda_sent_invitations');
                    
                    if (cachedReceived) {
                        this.receivedInvitations = JSON.parse(cachedReceived);
                    } else {
                        this.receivedInvitations = this.generateDemoReceivedInvitations();
                        localStorage.setItem('latanda_received_invitations', JSON.stringify(this.receivedInvitations));
                    }

                    if (cachedSent) {
                        this.sentInvitations = JSON.parse(cachedSent);
                    } else {
                        this.sentInvitations = this.generateDemoSentInvitations();
                        localStorage.setItem('latanda_sent_invitations', JSON.stringify(this.sentInvitations));
                    }

                    this.renderInvitations();
                    this.updateCounts();
                    console.log(`‚úÖ Loaded ${this.receivedInvitations.length} received and ${this.sentInvitations.length} sent invitations`);
                } catch (error) {
                    console.error('Error loading invitations:', error);
                    this.receivedInvitations = this.generateDemoReceivedInvitations();
                    this.sentInvitations = this.generateDemoSentInvitations();
                    this.renderInvitations();
                    this.updateCounts();
                }
            }

            generateDemoReceivedInvitations() {
                return [
                    {
                        id: 'inv_rec_1',
                        type: 'group',
                        from: 'Mar√≠a Gonz√°lez',
                        fromEmail: 'maria.gonzalez@email.com',
                        title: 'Unirse a Tanda Ahorro Familiar',
                        description: 'Te invito a participar en nuestra tanda familiar de $500 mensuales. Somos un grupo confiable con 2 a√±os de experiencia.',
                        targetGroup: 'Tanda Ahorro Familiar - $500',
                        amount: 500,
                        status: 'pending',
                        date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                        expiresAt: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                        personalMessage: 'Hola! Te invito a nuestra tanda familiar. Somos muy responsables y siempre cumplimos con los pagos.'
                    },
                    {
                        id: 'inv_rec_2',
                        type: 'collaboration',
                        from: 'Carlos Mendoza',
                        fromEmail: 'carlos.mendoza@email.com',
                        title: 'Colaboraci√≥n en Proyecto DeFi',
                        description: 'Invitaci√≥n para colaborar en el desarrollo de una nueva plataforma DeFi basada en La Tanda.',
                        status: 'pending',
                        date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                        expiresAt: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString(),
                        personalMessage: 'Tu experiencia en blockchain ser√≠a muy valiosa para este proyecto.'
                    },
                    {
                        id: 'inv_rec_3',
                        type: 'tanda',
                        from: 'Ana Rodr√≠guez',
                        fromEmail: 'ana.rodriguez@email.com',
                        title: 'Tanda Emprendedores $1000',
                        description: '√önete a nuestra tanda de emprendedores. Perfecto para impulsar tu negocio.',
                        targetGroup: 'Grupo Emprendedores - $1000',
                        amount: 1000,
                        status: 'accepted',
                        date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                        acceptedAt: new Date(Date.now() - 6 * 24 * 60 * 60 * 1000).toISOString(),
                        personalMessage: 'Creo que esta tanda te ayudar√≠a mucho con tu startup.'
                    }
                ];
            }

            generateDemoSentInvitations() {
                return [
                    {
                        id: 'inv_sent_1',
                        type: 'referral',
                        to: 'Pedro L√≥pez',
                        toEmail: 'pedro.lopez@email.com',
                        title: 'Referir a La Tanda Platform',
                        description: 'Invitaci√≥n para unirse a La Tanda y ganar recompensas por referidos.',
                        status: 'sent',
                        date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                        expiresAt: new Date(Date.now() + 4 * 24 * 60 * 60 * 1000).toISOString(),
                        personalMessage: '¬°Hola Pedro! Te invito a probar La Tanda. Es una excelente plataforma para ahorrar.'
                    },
                    {
                        id: 'inv_sent_2',
                        type: 'group',
                        to: 'Laura Mart√≠nez',
                        toEmail: 'laura.martinez@email.com',
                        title: 'Invitaci√≥n a Tanda Estudiantil',
                        description: 'Invitaci√≥n para unirse a nuestra tanda estudiantil de $200.',
                        targetGroup: 'Tanda Estudiantil - $200',
                        amount: 200,
                        status: 'accepted',
                        date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                        acceptedAt: new Date(Date.now() - 4 * 24 * 60 * 60 * 1000).toISOString(),
                        personalMessage: 'Laura, esta tanda es perfecta para estudiantes como nosotros.'
                    },
                    {
                        id: 'inv_sent_3',
                        type: 'tanda',
                        to: 'Roberto Silva',
                        toEmail: 'roberto.silva@email.com',
                        title: 'Inversi√≥n Colectiva $2000',
                        description: 'Invitaci√≥n para participar en una tanda de inversi√≥n de alto valor.',
                        targetGroup: 'Inversi√≥n Colectiva - $2000',
                        amount: 2000,
                        status: 'declined',
                        date: new Date(Date.now() - 4 * 24 * 60 * 60 * 1000).toISOString(),
                        declinedAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                        personalMessage: 'Roberto, esta es una excelente oportunidad de inversi√≥n.'
                    }
                ];
            }

            renderInvitations() {
                this.renderReceivedInvitations();
                this.renderSentInvitations();
            }

            renderReceivedInvitations() {
                const container = document.getElementById('receivedInvitations');
                
                if (this.receivedInvitations.length === 0) {
                    container.innerHTML = this.getEmptyState('No tienes invitaciones recibidas', 'fas fa-inbox');
                    return;
                }

                const invitationsHTML = this.receivedInvitations.map(invitation => {
                    const statusClass = `status-${invitation.status}`;
                    const date = new Date(invitation.date);
                    const formattedDate = date.toLocaleDateString('es-ES');
                    const expiresAt = new Date(invitation.expiresAt);
                    const daysUntilExpiration = Math.ceil((expiresAt - new Date()) / (1000 * 60 * 60 * 24));

                    const statusLabels = {
                        pending: 'Pendiente',
                        accepted: 'Aceptada',
                        declined: 'Rechazada'
                    };

                    const typeIcons = {
                        group: 'fas fa-users',
                        tanda: 'fas fa-coins',
                        referral: 'fas fa-user-plus',
                        collaboration: 'fas fa-handshake'
                    };

                    let actionButtons = '';
                    if (invitation.status === 'pending') {
                        actionButtons = `
                            <div class="invitation-actions">
                                <button class="btn-action btn-accept" onclick="acceptInvitation('${invitation.id}')">
                                    <i class="fas fa-check"></i> Aceptar
                                </button>
                                <button class="btn-action btn-decline" onclick="declineInvitation('${invitation.id}')">
                                    <i class="fas fa-times"></i> Rechazar
                                </button>
                                <button class="btn-action btn-view" onclick="viewInvitationDetails('${invitation.id}', 'received')">
                                    <i class="fas fa-eye"></i> Ver Detalles
                                </button>
                            </div>
                        `;
                    } else {
                        actionButtons = `
                            <div class="invitation-actions">
                                <button class="btn-action btn-view" onclick="viewInvitationDetails('${invitation.id}', 'received')">
                                    <i class="fas fa-eye"></i> Ver Detalles
                                </button>
                            </div>
                        `;
                    }

                    return `
                        <div class="invitation-card">
                            <div class="invitation-header">
                                <div class="invitation-info">
                                    <div class="invitation-title">
                                        <i class="${typeIcons[invitation.type]}"></i> ${invitation.title}
                                    </div>
                                    <div class="invitation-meta">
                                        <span><i class="fas fa-user"></i> De: ${invitation.from}</span>
                                        <span><i class="fas fa-calendar"></i> ${formattedDate}</span>
                                        ${invitation.amount ? `<span><i class="fas fa-dollar-sign"></i> $${invitation.amount}</span>` : ''}
                                        ${invitation.status === 'pending' ? `<span><i class="fas fa-clock"></i> Expira en ${daysUntilExpiration} d√≠as</span>` : ''}
                                    </div>
                                    <div class="invitation-description">${invitation.description}</div>
                                </div>
                                <div class="invitation-status ${statusClass}">${statusLabels[invitation.status]}</div>
                            </div>
                            ${actionButtons}
                        </div>
                    `;
                }).join('');

                container.innerHTML = invitationsHTML;
            }

            renderSentInvitations() {
                const container = document.getElementById('sentInvitations');
                
                if (this.sentInvitations.length === 0) {
                    container.innerHTML = this.getEmptyState('No has enviado invitaciones', 'fas fa-paper-plane');
                    return;
                }

                const invitationsHTML = this.sentInvitations.map(invitation => {
                    const statusClass = `status-${invitation.status}`;
                    const date = new Date(invitation.date);
                    const formattedDate = date.toLocaleDateString('es-ES');

                    const statusLabels = {
                        sent: 'Enviada',
                        accepted: 'Aceptada',
                        declined: 'Rechazada'
                    };

                    const typeIcons = {
                        group: 'fas fa-users',
                        tanda: 'fas fa-coins',
                        referral: 'fas fa-user-plus',
                        collaboration: 'fas fa-handshake'
                    };

                    let actionButtons = '';
                    if (invitation.status === 'sent') {
                        actionButtons = `
                            <div class="invitation-actions">
                                <button class="btn-action btn-resend" onclick="resendInvitation('${invitation.id}')">
                                    <i class="fas fa-redo"></i> Reenviar
                                </button>
                                <button class="btn-action btn-view" onclick="viewInvitationDetails('${invitation.id}', 'sent')">
                                    <i class="fas fa-eye"></i> Ver Detalles
                                </button>
                            </div>
                        `;
                    } else {
                        actionButtons = `
                            <div class="invitation-actions">
                                <button class="btn-action btn-view" onclick="viewInvitationDetails('${invitation.id}', 'sent')">
                                    <i class="fas fa-eye"></i> Ver Detalles
                                </button>
                            </div>
                        `;
                    }

                    return `
                        <div class="invitation-card">
                            <div class="invitation-header">
                                <div class="invitation-info">
                                    <div class="invitation-title">
                                        <i class="${typeIcons[invitation.type]}"></i> ${invitation.title}
                                    </div>
                                    <div class="invitation-meta">
                                        <span><i class="fas fa-user"></i> Para: ${invitation.to}</span>
                                        <span><i class="fas fa-calendar"></i> ${formattedDate}</span>
                                        ${invitation.amount ? `<span><i class="fas fa-dollar-sign"></i> $${invitation.amount}</span>` : ''}
                                    </div>
                                    <div class="invitation-description">${invitation.description}</div>
                                </div>
                                <div class="invitation-status ${statusClass}">${statusLabels[invitation.status]}</div>
                            </div>
                            ${actionButtons}
                        </div>
                    `;
                }).join('');

                container.innerHTML = invitationsHTML;
            }

            getEmptyState(message, icon) {
                return `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="${icon}"></i>
                        </div>
                        <div class="empty-title">${message}</div>
                        <div class="empty-description">Las invitaciones aparecer√°n aqu√≠ cuando las recibas o env√≠es.</div>
                    </div>
                `;
            }

            updateCounts() {
                document.getElementById('receivedCount').textContent = this.receivedInvitations.filter(inv => inv.status === 'pending').length;
                document.getElementById('sentCount').textContent = this.sentInvitations.filter(inv => inv.status === 'sent').length;
            }

            createInvitation() {
                const formData = {
                    type: document.getElementById('invitationType').value,
                    recipientEmail: document.getElementById('recipientEmail').value,
                    recipientName: document.getElementById('recipientName').value,
                    targetGroup: document.getElementById('targetGroup').value,
                    personalMessage: document.getElementById('personalMessage').value,
                    expirationDate: document.getElementById('expirationDate').value
                };

                const newInvitation = {
                    id: `inv_sent_${Date.now()}`,
                    type: formData.type,
                    to: formData.recipientName,
                    toEmail: formData.recipientEmail,
                    title: this.getInvitationTitle(formData.type, formData.targetGroup),
                    description: this.getInvitationDescription(formData.type, formData.targetGroup),
                    targetGroup: formData.targetGroup,
                    status: 'sent',
                    date: new Date().toISOString(),
                    expiresAt: new Date(formData.expirationDate).toISOString(),
                    personalMessage: formData.personalMessage || 'Te invito a unirte a La Tanda.'
                };

                this.sentInvitations.unshift(newInvitation);
                localStorage.setItem('latanda_sent_invitations', JSON.stringify(this.sentInvitations));
                
                this.renderSentInvitations();
                this.updateCounts();
                
                // Reset form
                document.getElementById('invitationForm').reset();
                this.setDefaultExpirationDate();
                
                // Show success message
                this.showNotification('‚úÖ Invitaci√≥n Enviada', 'La invitaci√≥n ha sido enviada exitosamente.');
                
                // Switch to sent tab
                switchTab('sent');
            }

            getInvitationTitle(type, targetGroup) {
                const titles = {
                    group: `Unirse a ${targetGroup || 'Grupo'}`,
                    tanda: `Participar en ${targetGroup || 'Tanda'}`,
                    referral: 'Referir a La Tanda Platform',
                    collaboration: 'Propuesta de Colaboraci√≥n'
                };
                return titles[type] || 'Nueva Invitaci√≥n';
            }

            getInvitationDescription(type, targetGroup) {
                const descriptions = {
                    group: `Invitaci√≥n para unirse al grupo: ${targetGroup || 'Grupo seleccionado'}`,
                    tanda: `Invitaci√≥n para participar en: ${targetGroup || 'Tanda seleccionada'}`,
                    referral: 'Invitaci√≥n para unirse a La Tanda y ganar recompensas por referidos.',
                    collaboration: 'Propuesta de colaboraci√≥n en la plataforma La Tanda.'
                };
                return descriptions[type] || 'Nueva invitaci√≥n de La Tanda.';
            }

            showNotification(title, message) {
                // Simple notification - could be enhanced with a proper notification system
                alert(`${title}\n${message}`);
            }

            acceptInvitation(invitationId) {
                const invitation = this.receivedInvitations.find(inv => inv.id === invitationId);
                if (invitation) {
                    invitation.status = 'accepted';
                    invitation.acceptedAt = new Date().toISOString();
                    localStorage.setItem('latanda_received_invitations', JSON.stringify(this.receivedInvitations));
                    this.renderReceivedInvitations();
                    this.updateCounts();
                    this.showNotification('‚úÖ Invitaci√≥n Aceptada', 'Has aceptado la invitaci√≥n exitosamente.');
                }
            }

            declineInvitation(invitationId) {
                const invitation = this.receivedInvitations.find(inv => inv.id === invitationId);
                if (invitation) {
                    invitation.status = 'declined';
                    invitation.declinedAt = new Date().toISOString();
                    localStorage.setItem('latanda_received_invitations', JSON.stringify(this.receivedInvitations));
                    this.renderReceivedInvitations();
                    this.updateCounts();
                    this.showNotification('‚ùå Invitaci√≥n Rechazada', 'Has rechazado la invitaci√≥n.');
                }
            }

            resendInvitation(invitationId) {
                const invitation = this.sentInvitations.find(inv => inv.id === invitationId);
                if (invitation) {
                    invitation.date = new Date().toISOString();
                    localStorage.setItem('latanda_sent_invitations', JSON.stringify(this.sentInvitations));
                    this.renderSentInvitations();
                    this.showNotification('üì§ Invitaci√≥n Reenviada', 'La invitaci√≥n ha sido reenviada exitosamente.');
                }
            }

            viewInvitationDetails(invitationId, type) {
                const invitations = type === 'received' ? this.receivedInvitations : this.sentInvitations;
                const invitation = invitations.find(inv => inv.id === invitationId);
                
                if (!invitation) return;

                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0, 0, 0, 0.8); display: flex; align-items: center; 
                    justify-content: center; z-index: 1000; backdrop-filter: blur(8px);
                `;

                const typeIcons = {
                    group: 'fas fa-users',
                    tanda: 'fas fa-coins',
                    referral: 'fas fa-user-plus',
                    collaboration: 'fas fa-handshake'
                };

                const personLabel = type === 'received' ? 'De' : 'Para';
                const personName = type === 'received' ? invitation.from : invitation.to;
                const personEmail = type === 'received' ? invitation.fromEmail : invitation.toEmail;

                modal.innerHTML = `
                    <div style="background: var(--bg-card); backdrop-filter: blur(24px); border: 2px solid var(--border-accent);
                               border-radius: 20px; padding: 32px; max-width: 600px; width: 90%; position: relative;">
                        <button onclick="this.closest('div').remove()" 
                                style="position: absolute; top: 16px; right: 16px; background: none; border: none; 
                                       color: var(--text-secondary); font-size: 24px; cursor: pointer;">√ó</button>
                        
                        <div style="text-align: center; margin-bottom: 24px;">
                            <div style="width: 64px; height: 64px; margin: 0 auto 16px; background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light)); 
                                 border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--tanda-black);">
                                <i class="${typeIcons[invitation.type]}"></i>
                            </div>
                            <h2 style="color: var(--tanda-cyan); margin-bottom: 8px;">${invitation.title}</h2>
                            <div style="color: var(--text-secondary);">${invitation.description}</div>
                        </div>
                        
                        <div style="space-y: 16px;">
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-card);">
                                <span style="color: var(--text-secondary);">${personLabel}:</span>
                                <span style="color: var(--text-primary); font-weight: 600;">${personName}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-card);">
                                <span style="color: var(--text-secondary);">Email:</span>
                                <span style="color: var(--text-primary);">${personEmail}</span>
                            </div>
                            ${invitation.targetGroup ? `
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-card);">
                                <span style="color: var(--text-secondary);">Grupo/Tanda:</span>
                                <span style="color: var(--text-primary);">${invitation.targetGroup}</span>
                            </div>
                            ` : ''}
                            ${invitation.amount ? `
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-card);">
                                <span style="color: var(--text-secondary);">Monto:</span>
                                <span style="color: var(--tanda-cyan); font-weight: 700;">$${invitation.amount}</span>
                            </div>
                            ` : ''}
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-card);">
                                <span style="color: var(--text-secondary);">Fecha:</span>
                                <span style="color: var(--text-primary);">${new Date(invitation.date).toLocaleDateString('es-ES')}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-card);">
                                <span style="color: var(--text-secondary);">Estado:</span>
                                <span style="color: var(--text-primary);">${invitation.status}</span>
                            </div>
                            ${invitation.personalMessage ? `
                            <div style="padding: 12px 0;">
                                <span style="color: var(--text-secondary);">Mensaje:</span>
                                <div style="color: var(--text-primary); background: rgba(0, 0, 0, 0.3); padding: 12px; border-radius: 8px; margin-top: 8px;">
                                    "${invitation.personalMessage}"
                                </div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
            }
        }

        // Global functions
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update sections
            document.querySelectorAll('.invitation-section').forEach(section => section.classList.remove('active'));
            document.getElementById(`${tabName}-section`).classList.add('active');

            invitationManager.currentTab = tabName;
        }

        function acceptInvitation(invitationId) {
            invitationManager.acceptInvitation(invitationId);
        }

        function declineInvitation(invitationId) {
            invitationManager.declineInvitation(invitationId);
        }

        function resendInvitation(invitationId) {
            invitationManager.resendInvitation(invitationId);
        }

        function viewInvitationDetails(invitationId, type) {
            invitationManager.viewInvitationDetails(invitationId, type);
        }

        // Initialize the invitation manager when page loads
        let invitationManager;
        document.addEventListener('DOMContentLoaded', () => {
            invitationManager = new InvitationManager();
        });
    </script>
</body>
</html>
