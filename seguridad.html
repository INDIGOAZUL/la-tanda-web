<!DOCTYPE html>
<html lang="es">
<head>
  <script type="module" crossorigin src="/assets/js/polyfills--1Z-T_Bc.js"></script>

    <meta charset="UTF-8">
    <!-- Resource Optimization -->
    <!-- DNS Prefetch for external resources -->
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <!-- Preconnect to critical origins -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è Centro de Seguridad | La Tanda Web3</title>
    <!-- Critical CSS: Font Awesome with async loading -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" crossorigin="anonymous" onload="this.onload=null;this.rel=stylesheet">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha384-iw3OoTErCYJJB9mCa8LNS2hbsQ7M3C0EpIsO/H5+EGAkPGc6rk+V8i04oW/K5xq0" crossorigin="anonymous"></noscript>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Optimized Google Fonts loading -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" as="style" onload="this.onload=null;this.rel=stylesheet">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"></noscript>
    <style>
        /* ================================
           üåê WEB3 DESIGN SYSTEM
           ================================ */
        :root {
            /* La Tanda Web3 Colors */
            --tanda-cyan: #00FFFF;
            --tanda-cyan-light: #7FFFD8;
            --tanda-cyan-dark: #00E5E5;
            --tanda-black: #000000;
            --text-primary: #f8fafc;
            --text-secondary: rgba(248, 250, 252, 0.7);
            --text-accent: #00FFFF;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: rgba(15, 23, 42, 0.6);
            --border-card: rgba(0, 255, 255, 0.1);
            --border-accent: rgba(0, 255, 255, 0.2);
            --crypto-gold: #ffd700;
            --success-color: #22d55e;
            --warning-color: #fbbf24;
            --error-color: #f87171;
            --info-color: #3b82f6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }
        
        /* ================================
           ‚ú® BACKGROUND EFFECTS
           ================================ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 255, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(255, 215, 0, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* ================================
           üß≠ NAVIGATION
           ================================ */
        .nav-header {
            background: var(--bg-card);
            backdrop-filter: blur(24px);
            border: 1px solid var(--border-accent);
            border-radius: 16px;
            padding: 20px 24px;
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .back-btn {
            background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
            color: var(--tanda-black);
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }
        
        .nav-links {
            display: flex;
            gap: 16px;
        }
        
        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .nav-link:hover {
            color: var(--tanda-cyan);
            background: rgba(0, 255, 255, 0.1);
            border-color: var(--border-accent);
        }
        
        /* ================================
           üìä MAIN CONTAINER
           ================================ */
        .security-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        /* ================================
           üõ°Ô∏è SECURITY OVERVIEW
           ================================ */
        .security-overview {
            background: var(--bg-card);
            backdrop-filter: blur(24px);
            border: 1px solid var(--border-card);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .overview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .security-score {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .score-circle {
            position: relative;
            width: 80px;
            height: 80px;
        }
        
        .score-svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }
        
        .score-bg {
            fill: none;
            stroke: rgba(0, 255, 255, 0.1);
            stroke-width: 8;
        }
        
        .score-progress {
            fill: none;
            stroke: var(--tanda-cyan);
            stroke-width: 8;
            stroke-dasharray: 251.2;
            stroke-dashoffset: 62.8;
            transition: stroke-dashoffset 1s ease;
            filter: drop-shadow(0 0 8px rgba(0, 255, 255, 0.5));
        }
        
        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            font-weight: 700;
            color: var(--tanda-cyan);
        }
        
        .score-info h3 {
            font-size: 20px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .score-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--success-color);
            font-weight: 600;
        }
        
        .emergency-freeze {
            background: linear-gradient(135deg, var(--error-color), #dc2626);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .emergency-freeze:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(248, 113, 113, 0.3);
        }
        
        /* ================================
           üìã SECURITY TABS
           ================================ */
        .security-tabs {
            background: var(--bg-card);
            backdrop-filter: blur(24px);
            border: 1px solid var(--border-card);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .tab-navigation {
            display: flex;
            gap: 4px;
            margin-bottom: 32px;
            background: rgba(0, 0, 0, 0.3);
            padding: 4px;
            border-radius: 12px;
            overflow-x: auto;
        }
        
        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
            color: var(--tanda-black);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);
        }
        
        .tab-btn:hover:not(.active) {
            background: rgba(0, 255, 255, 0.1);
            color: var(--tanda-cyan);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* ================================
           üîê 2FA SECTION
           ================================ */
        .security-setting {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }
        
        .security-setting:hover {
            border-color: var(--border-accent);
            transform: translateY(-1px);
        }
        
        .setting-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .setting-info h4 {
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .setting-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .setting-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background: rgba(100, 116, 139, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle-switch.active {
            background: var(--tanda-cyan);
        }
        
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }
        
        .setting-status {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 6px;
        }
        
        .status-enabled {
            background: rgba(34, 213, 94, 0.2);
            color: var(--success-color);
        }
        
        .status-disabled {
            background: rgba(100, 116, 139, 0.2);
            color: var(--text-secondary);
        }
        
        /* ================================
           üì± DEVICES SECTION
           ================================ */
        .device-item {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .device-item:hover {
            border-color: var(--border-accent);
            transform: translateY(-1px);
        }
        
        .device-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .device-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
            color: var(--tanda-black);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .device-details h4 {
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .device-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            gap: 16px;
        }
        
        .device-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-secondary {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-card);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            color: var(--tanda-cyan);
            border-color: var(--tanda-cyan);
        }
        
        .btn-danger {
            background: rgba(248, 113, 113, 0.2);
            color: var(--error-color);
            border: 1px solid var(--error-color);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            background: var(--error-color);
            color: white;
        }
        
        /* ================================
           üìä ACTIVITY LOG
           ================================ */
        .activity-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-card);
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        
        .activity-item:hover {
            border-color: var(--border-accent);
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .activity-success {
            background: rgba(34, 213, 94, 0.2);
            color: var(--success-color);
        }
        
        .activity-warning {
            background: rgba(251, 191, 36, 0.2);
            color: var(--warning-color);
        }
        
        .activity-error {
            background: rgba(248, 113, 113, 0.2);
            color: var(--error-color);
        }
        
        .activity-details {
            flex: 1;
        }
        
        .activity-title {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .activity-meta {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* ================================
           üì± RESPONSIVE DESIGN
           ================================ */
        @media (max-width: 768px) {
            body {
                padding: 16px;
            }
            
            .nav-header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            .nav-left {
                flex-direction: column;
                gap: 12px;
            }
            
            .overview-header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            .security-score {
                justify-content: center;
            }
            
            .tab-navigation {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                min-width: 100px;
                font-size: 12px;
            }
            
            .device-item {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            .device-info {
                flex-direction: column;
                text-align: center;
            }
            
            .setting-header {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }
        }
        
        /* ================================
           ‚ú® ANIMATIONS
           ================================ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
  <script async type="module" crossorigin src="/assets/js/seguridad-6F3hq9O7.js"></script>
  <script type="module">import.meta.url;import("_").catch(()=>1);(async function*(){})().next();if(location.protocol!="file:"){window.__vite_is_modern_browser=true}</script>
  <script type="module">!function(){if(window.__vite_is_modern_browser)return;console.warn("vite: loading legacy chunks, syntax error above and the same error below should be ignored");var e=document.getElementById("vite-legacy-polyfill"),n=document.createElement("script");n.src=e.src,n.onload=function(){System.import(document.getElementById('vite-legacy-entry').getAttribute('data-src'))},document.body.appendChild(n)}();</script>
<link rel="manifest" href="/manifest.webmanifest"><script id="vite-plugin-pwa:register-sw" src="/registerSW.js"></script>    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/header.css?v=24.5">
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://latanda.online/seguridad.html">
    <meta property="og:title" content="Seguridad | La Tanda">
    <meta property="og:description" content="Gestiona la seguridad de tu cuenta, contrasena y 2FA.">
    <meta property="og:image" content="https://latanda.online/assets/og-image.png">
    <meta property="og:site_name" content="La Tanda">
    <meta property="og:locale" content="es_HN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Seguridad | La Tanda">
    <meta name="twitter:description" content="Gestiona la seguridad de tu cuenta, contrasena y 2FA.">
    <meta name="twitter:image" content="https://latanda.online/assets/og-image.png">
</head>
<body>
    <!-- Global Header Component -->
    <div id="global-header"></div>
    <!-- Navigation Header -->
    <nav class="nav-header">
        <div class="nav-left">
            <button class="back-btn" onclick="window.location.href='home-dashboard.html'">
                <i class="fas fa-arrow-left"></i> Dashboard
            </button>
            <h1 class="page-title">
                <i class="fas fa-shield-alt"></i> Centro de Seguridad
            </h1>
        </div>
        <div class="nav-links">
            <a href="mi-perfil.html" class="nav-link">
                <i class="fas fa-user"></i> Mi Perfil
            </a>
            <a href="my-wallet.html" class="nav-link">
                <i class="fas fa-wallet"></i> Wallet
            </a>
            <a href="configuracion.html" class="nav-link">
                <i class="fas fa-cog"></i> Configuraci√≥n
            </a>
        </div>
    </nav>

    <div class="security-container">
        <!-- Security Overview -->
        <div class="security-overview">
            <div class="overview-header">
                <div class="security-score">
                    <div class="score-circle">
                        <svg class="score-svg" viewBox="0 0 90 90">
                            <circle class="score-bg" cx="45" cy="45" r="40"></circle>
                            <circle class="score-progress" cx="45" cy="45" r="40" id="scoreProgress"></circle>
                        </svg>
                        <div class="score-text" id="scoreText">85%</div>
                    </div>
                    <div class="score-info">
                        <h3>Nivel de Seguridad</h3>
                        <div class="score-status">
                            <i class="fas fa-check-circle"></i>
                            Muy Seguro
                        </div>
                    </div>
                </div>
                <button class="emergency-freeze" onclick="showEmergencyFreeze()">
                    <i class="fas fa-snowflake"></i> Congelar Cuenta
                </button>
            </div>
        </div>

        <!-- Security Tabs -->
        <div class="security-tabs">
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchTab('authentication')">
                    <i class="fas fa-key"></i> Autenticaci√≥n
                </button>
                <button class="tab-btn" onclick="switchTab('devices')">
                    <i class="fas fa-mobile-alt"></i> Dispositivos
                </button>
                <button class="tab-btn" onclick="switchTab('activity')">
                    <i class="fas fa-history"></i> Actividad
                </button>
                <button class="tab-btn" onclick="switchTab('privacy')">
                    <i class="fas fa-eye-slash"></i> Privacidad
                </button>
                <button class="tab-btn" onclick="switchTab('backup')">
                    <i class="fas fa-download"></i> Backup
                </button>
            </div>

            <!-- Authentication Tab -->
            <div id="authentication" class="tab-content active">
                <div class="security-setting">
                    <div class="setting-header">
                        <div class="setting-info">
                            <h4><i class="fas fa-mobile-alt"></i> Autenticaci√≥n de Dos Factores (2FA)</h4>
                            <p class="setting-description">
                                Agrega una capa extra de seguridad usando tu tel√©fono m√≥vil para confirmar tu identidad.
                            </p>
                        </div>
                        <div class="setting-toggle">
                            <div class="setting-status status-enabled">Habilitado</div>
                            <div class="toggle-switch active" onclick="toggle2FA()">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="security-setting">
                    <div class="setting-header">
                        <div class="setting-info">
                            <h4><i class="fas fa-envelope"></i> Verificaci√≥n por Email</h4>
                            <p class="setting-description">
                                Recibe c√≥digos de verificaci√≥n en tu email para transacciones importantes.
                            </p>
                        </div>
                        <div class="setting-toggle">
                            <div class="setting-status status-enabled">Habilitado</div>
                            <div class="toggle-switch active" onclick="toggleEmailVerification()">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="security-setting">
                    <div class="setting-header">
                        <div class="setting-info">
                            <h4><i class="fas fa-sms"></i> Verificaci√≥n por SMS</h4>
                            <p class="setting-description">
                                Recibe c√≥digos de verificaci√≥n por mensaje de texto a tu n√∫mero registrado.
                            </p>
                        </div>
                        <div class="setting-toggle">
                            <div class="setting-status status-disabled">Deshabilitado</div>
                            <div class="toggle-switch" onclick="toggleSMSVerification()">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="security-setting">
                    <div class="setting-header">
                        <div class="setting-info">
                            <h4><i class="fas fa-dollar-sign"></i> L√≠mites de Transacciones</h4>
                            <p class="setting-description">
                                Configura l√≠mites diarios y mensuales para transferencias y retiros.
                            </p>
                        </div>
                        <div class="setting-toggle">
                            <button class="btn-secondary" onclick="configureTransactionLimits()">
                                <i class="fas fa-cog"></i> Configurar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Devices Tab -->
            <div id="devices" class="tab-content">
                <div class="device-item">
                    <div class="device-info">
                        <div class="device-icon">
                            <i class="fas fa-desktop"></i>
                        </div>
                        <div class="device-details">
                            <h4>Windows Desktop - Chrome</h4>
                            <div class="device-meta">
                                <span><i class="fas fa-map-marker-alt"></i> Ciudad de M√©xico, M√©xico</span>
                                <span><i class="fas fa-clock"></i> √öltimo acceso: Hace 5 min</span>
                                <span><i class="fas fa-circle" style="color: var(--success-color);"></i> Activo ahora</span>
                            </div>
                        </div>
                    </div>
                    <div class="device-actions">
                        <button class="btn-secondary">
                            <i class="fas fa-info-circle"></i> Detalles
                        </button>
                    </div>
                </div>

                <div class="device-item">
                    <div class="device-info">
                        <div class="device-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <div class="device-details">
                            <h4>iPhone 13 - Safari</h4>
                            <div class="device-meta">
                                <span><i class="fas fa-map-marker-alt"></i> Ciudad de M√©xico, M√©xico</span>
                                <span><i class="fas fa-clock"></i> √öltimo acceso: Hace 2 horas</span>
                                <span><i class="fas fa-circle" style="color: var(--text-secondary);"></i> Inactivo</span>
                            </div>
                        </div>
                    </div>
                    <div class="device-actions">
                        <button class="btn-secondary">
                            <i class="fas fa-info-circle"></i> Detalles
                        </button>
                        <button class="btn-danger" onclick="revokeDevice('mobile1')">
                            <i class="fas fa-ban"></i> Revocar
                        </button>
                    </div>
                </div>

                <div class="device-item">
                    <div class="device-info">
                        <div class="device-icon">
                            <i class="fas fa-tablet-alt"></i>
                        </div>
                        <div class="device-details">
                            <h4>iPad Pro - Safari</h4>
                            <div class="device-meta">
                                <span><i class="fas fa-map-marker-alt"></i> Guadalajara, M√©xico</span>
                                <span><i class="fas fa-clock"></i> √öltimo acceso: Hace 3 d√≠as</span>
                                <span><i class="fas fa-circle" style="color: var(--text-secondary);"></i> Inactivo</span>
                            </div>
                        </div>
                    </div>
                    <div class="device-actions">
                        <button class="btn-secondary">
                            <i class="fas fa-info-circle"></i> Detalles
                        </button>
                        <button class="btn-danger" onclick="revokeDevice('tablet1')">
                            <i class="fas fa-ban"></i> Revocar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Activity Tab -->
            <div id="activity" class="tab-content">
                <div class="activity-item">
                    <div class="activity-icon activity-success">
                        <i class="fas fa-sign-in-alt"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-title">Inicio de sesi√≥n exitoso</div>
                        <div class="activity-meta">Hoy 15:45 ‚Ä¢ Windows Desktop ‚Ä¢ Ciudad de M√©xico</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="activity-icon activity-success">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-title">2FA configurado</div>
                        <div class="activity-meta">Hoy 12:30 ‚Ä¢ iPhone 13 ‚Ä¢ Ciudad de M√©xico</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="activity-icon activity-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-title">Intento de acceso desde nueva ubicaci√≥n</div>
                        <div class="activity-meta">Ayer 22:15 ‚Ä¢ Ubicaci√≥n desconocida ‚Ä¢ IP: 192.168.1.100</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="activity-icon activity-success">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-title">Cambio de contrase√±a</div>
                        <div class="activity-meta">Hace 2 d√≠as 14:20 ‚Ä¢ Windows Desktop ‚Ä¢ Ciudad de M√©xico</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="activity-icon activity-error">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-title">Intento de inicio de sesi√≥n fallido</div>
                        <div class="activity-meta">Hace 3 d√≠as 09:30 ‚Ä¢ IP: 203.0.113.42 ‚Ä¢ Contrase√±a incorrecta</div>
                    </div>
                </div>
            </div>

            <!-- Privacy Tab -->
            <div id="privacy" class="tab-content">
                <div class="security-setting">
                    <div class="setting-header">
                        <div class="setting-info">
                            <h4><i class="fas fa-eye"></i> Perfil P√∫blico</h4>
                            <p class="setting-description">
                                Permite que otros usuarios vean tu perfil y estad√≠sticas b√°sicas.
                            </p>
                        </div>
                        <div class="setting-toggle">
                            <div class="setting-status status-enabled">Habilitado</div>
                            <div class="toggle-switch active" onclick="togglePublicProfile()">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="security-setting">
                    <div class="setting-header">
                        <div class="setting-info">
                            <h4><i class="fas fa-chart-bar"></i> Mostrar Actividad</h4>
                            <p class="setting-description">
                                Permite que otros vean tu actividad reciente en transacciones y grupos.
                            </p>
                        </div>
                        <div class="setting-toggle">
                            <div class="setting-status status-disabled">Deshabilitado</div>
                            <div class="toggle-switch" onclick="toggleActivityVisibility()">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="security-setting">
                    <div class="setting-header">
                        <div class="setting-info">
                            <h4><i class="fas fa-list"></i> Lista Blanca de Direcciones</h4>
                            <p class="setting-description">
                                Gestiona las direcciones de wallet autorizadas para transferencias r√°pidas.
                            </p>
                        </div>
                        <div class="setting-toggle">
                            <button class="btn-secondary" onclick="manageWhitelist()">
                                <i class="fas fa-cog"></i> Gestionar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Backup Tab -->
            <div id="backup" class="tab-content">
                <div class="security-setting">
                    <div class="setting-header">
                        <div class="setting-info">
                            <h4><i class="fas fa-key"></i> Frase Semilla de Wallet</h4>
                            <p class="setting-description">
                                Respalda tu frase semilla de 12 palabras para recuperar tu wallet en caso de p√©rdida.
                            </p>
                        </div>
                        <div class="setting-toggle">
                            <button class="btn-secondary" onclick="showSeedPhrase()">
                                <i class="fas fa-eye"></i> Ver Frase
                            </button>
                        </div>
                    </div>
                </div>

                <div class="security-setting">
                    <div class="setting-header">
                        <div class="setting-info">
                            <h4><i class="fas fa-download"></i> Exportar Datos</h4>
                            <p class="setting-description">
                                Descarga una copia de todos tus datos almacenados en La Tanda.
                            </p>
                        </div>
                        <div class="setting-toggle">
                            <button class="btn-secondary" onclick="exportData()">
                                <i class="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="security-setting">
                    <div class="setting-header">
                        <div class="setting-info">
                            <h4><i class="fas fa-shield-alt"></i> Backup Autom√°tico</h4>
                            <p class="setting-description">
                                Activa backups autom√°ticos encriptados en la nube para mayor seguridad.
                            </p>
                        </div>
                        <div class="setting-toggle">
                            <div class="setting-status status-enabled">Habilitado</div>
                            <div class="toggle-switch active" onclick="toggleAutoBackup()">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auth headers helper
        window.getAuthHeaders = function() {
            const token = localStorage.getItem('auth_token') || sessionStorage.getItem('auth_token') || '';
            return token ? { 'Authorization': 'Bearer ' + token } : {};
        };

        class SecurityManager {
            constructor() {
                this.securityStatus = null;
                this.devices = [];
                this.activities = [];
                this.securitySettings = {
                    twoFA: false,
                    emailVerification: false,
                    smsVerification: false,
                    pinConfigured: false,
                    publicProfile: true,
                    activityVisibility: false,
                    autoBackup: true
                };
                this.init();
            }

            async init() {
                await this.loadSecurityStatus();
                this.loadLocalSettings();
                this.setupEventListeners();
            }

            // Load security status from API
            async loadSecurityStatus() {
                try {
                    const response = await fetch('/api/user/security/status', {
                        headers: window.getAuthHeaders()
                    });
                    const result = await response.json();

                    if (result.success) {
                        this.securityStatus = result.security;

                        // Update local settings from API
                        this.securitySettings.twoFA = result.security.two_factor_enabled;
                        this.securitySettings.emailVerification = result.security.email_verified;
                        this.securitySettings.pinConfigured = result.security.pin_configured;

                        // Update UI
                        this.updateSecurityScore();
                        this.update2FAToggle();
                        this.updateEmailVerificationUI();
                        this.updatePINUI();

                    } else {
                        this.loadLocalSettings();
                    }
                } catch (err) {
                    this.loadLocalSettings();
                }
            }

            loadLocalSettings() {
                const savedSettings = localStorage.getItem('latanda_security_settings');
                if (savedSettings) {
                    this.securitySettings = { ...this.securitySettings, ...JSON.parse(savedSettings) };
                }
                this.updateSecurityScore();
            }

            saveLocalSettings() {
                localStorage.setItem('latanda_security_settings', JSON.stringify(this.securitySettings));
            }

            updateSecurityScore() {
                let score = 15; // Base score for having an account

                if (this.securityStatus) {
                    if (this.securityStatus.two_factor_enabled) score += 30;
                    if (this.securityStatus.email_verified) score += 20;
                    if (this.securityStatus.pin_configured) score += 20;
                    if (this.securityStatus.webauthn_devices > 0) score += 15;
                } else {
                    // Fallback to local settings
                    if (this.securitySettings.twoFA) score += 30;
                    if (this.securitySettings.emailVerification) score += 20;
                    if (this.securitySettings.pinConfigured) score += 20;
                }

                const percentage = Math.min(score, 100);

                // Update UI
                const scoreText = document.getElementById('scoreText');
                if (scoreText) scoreText.textContent = percentage + '%';

                const circle = document.getElementById('scoreProgress');
                if (circle) {
                    const circumference = 2 * Math.PI * 40;
                    const offset = circumference - (percentage / 100) * circumference;
                    circle.style.strokeDashoffset = offset;
                }

            }

            update2FAToggle() {
                const toggle = document.querySelector('[onclick="toggle2FA()"]');
                const status = toggle?.closest('.security-setting')?.querySelector('.setting-status');

                if (toggle) {
                    if (this.securitySettings.twoFA) {
                        toggle.classList.add('active');
                    } else {
                        toggle.classList.remove('active');
                    }
                }

                if (status) {
                    status.textContent = this.securitySettings.twoFA ? 'Habilitado' : 'Deshabilitado';
                    status.className = 'setting-status ' + (this.securitySettings.twoFA ? 'status-enabled' : 'status-disabled');
                }
            }

            updateEmailVerificationUI() {
                const toggle = document.querySelector('[onclick="toggleEmailVerification()"]');
                const status = toggle?.closest('.security-setting')?.querySelector('.setting-status');

                if (toggle) {
                    if (this.securitySettings.emailVerification) {
                        toggle.classList.add('active');
                    } else {
                        toggle.classList.remove('active');
                    }
                }

                if (status) {
                    status.textContent = this.securitySettings.emailVerification ? 'Verificado' : 'No verificado';
                    status.className = 'setting-status ' + (this.securitySettings.emailVerification ? 'status-enabled' : 'status-disabled');
                }
            }

            updatePINUI() {
                // Update any PIN-related UI elements
                const pinSection = document.querySelector('[data-setting="pin"]');
                if (pinSection) {
                    const status = pinSection.querySelector('.setting-status');
                    if (status) {
                        status.textContent = this.securitySettings.pinConfigured ? 'Configurado' : 'No configurado';
                        status.className = 'setting-status ' + (this.securitySettings.pinConfigured ? 'status-enabled' : 'status-disabled');
                    }
                }
            }

            setupEventListeners() {
                // Tab switch listeners to load data dynamically
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const tabName = btn.textContent.toLowerCase().trim();
                        if (tabName.includes('dispositivo')) {
                            this.loadDevices();
                        } else if (tabName.includes('actividad')) {
                            this.loadActivity();
                        }
                    });
                });
            }

            // Load devices from API
            async loadDevices() {
                const container = document.getElementById('devices');
                if (!container) return;

                // Show loading state
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 32px; color: var(--tanda-cyan);"></i>
                        <p style="color: var(--text-secondary); margin-top: 16px;">Cargando dispositivos...</p>
                    </div>
                `;

                try {
                    const response = await fetch('/api/user/devices', {
                        headers: window.getAuthHeaders()
                    });
                    const result = await response.json();

                    if (result.success) {
                        this.devices = result.devices;
                        this.renderDevices();
                    } else {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 40px;">
                                <i class="fas fa-exclamation-circle" style="font-size: 32px; color: var(--warning-color);"></i>
                                <p style="color: var(--text-secondary); margin-top: 16px;">No se pudieron cargar los dispositivos</p>
                            </div>
                        `;
                    }
                } catch (err) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-exclamation-circle" style="font-size: 32px; color: var(--error-color);"></i>
                            <p style="color: var(--text-secondary); margin-top: 16px;">Error de conexion</p>
                        </div>
                    `;
                }
            }

            renderDevices() {
                const container = document.getElementById('devices');
                if (!container) return;

                if (this.devices.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-desktop" style="font-size: 32px; color: var(--text-secondary);"></i>
                            <p style="color: var(--text-secondary); margin-top: 16px;">No hay dispositivos activos</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.devices.map(device => {
                    const iconClass = device.device_type === 'Mobile' ? 'fa-mobile-alt' :
                                     device.device_type === 'Tablet' ? 'fa-tablet-alt' : 'fa-desktop';

                    const timeAgo = this.formatTimeAgo(device.last_activity);
                    const statusColor = device.is_current ? 'var(--success-color)' : 'var(--text-secondary)';
                    const statusText = device.is_current ? 'Este dispositivo' : 'Inactivo';

                    return `
                        <div class="device-item" data-device-id="${device.id}">
                            <div class="device-info">
                                <div class="device-icon">
                                    <i class="fas ${iconClass}"></i>
                                </div>
                                <div class="device-details">
                                    <h4>${device.device_name}</h4>
                                    <div class="device-meta">
                                        <span><i class="fas fa-map-marker-alt"></i> ${device.location}</span>
                                        <span><i class="fas fa-clock"></i> ${timeAgo}</span>
                                        <span><i class="fas fa-circle" style="color: ${statusColor};"></i> ${statusText}</span>
                                    </div>
                                    <div class="device-meta" style="margin-top: 4px;">
                                        <span><i class="fas fa-network-wired"></i> IP: ${device.ip_address}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="device-actions">
                                ${!device.is_current ? `
                                    <button class="btn-danger" onclick="revokeDevice('${device.id}')">
                                        <i class="fas fa-ban"></i> Revocar
                                    </button>
                                ` : `
                                    <span style="color: var(--success-color); font-size: 14px;">
                                        <i class="fas fa-check-circle"></i> Sesion actual
                                    </span>
                                `}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Load activity from API
            async loadActivity() {
                const container = document.getElementById('activity');
                if (!container) return;

                // Show loading state
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 32px; color: var(--tanda-cyan);"></i>
                        <p style="color: var(--text-secondary); margin-top: 16px;">Cargando actividad...</p>
                    </div>
                `;

                try {
                    const response = await fetch('/api/user/activity?limit=20', {
                        headers: window.getAuthHeaders()
                    });
                    const result = await response.json();

                    if (result.success) {
                        this.activities = result.activities;
                        this.renderActivity();
                    } else {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 40px;">
                                <i class="fas fa-exclamation-circle" style="font-size: 32px; color: var(--warning-color);"></i>
                                <p style="color: var(--text-secondary); margin-top: 16px;">No se pudo cargar la actividad</p>
                            </div>
                        `;
                    }
                } catch (err) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-exclamation-circle" style="font-size: 32px; color: var(--error-color);"></i>
                            <p style="color: var(--text-secondary); margin-top: 16px;">Error de conexion</p>
                        </div>
                    `;
                }
            }

            renderActivity() {
                const container = document.getElementById('activity');
                if (!container) return;

                if (this.activities.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-history" style="font-size: 32px; color: var(--text-secondary);"></i>
                            <p style="color: var(--text-secondary); margin-top: 16px;">No hay actividad reciente</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.activities.map(activity => {
                    const statusClass = activity.status === 'success' ? 'activity-success' :
                                       activity.status === 'failed' ? 'activity-error' : 'activity-warning';

                    const timeStr = this.formatTimeAgo(activity.timestamp);

                    return `
                        <div class="activity-item">
                            <div class="activity-icon ${statusClass}">
                                <i class="${activity.icon || 'fas fa-circle'}"></i>
                            </div>
                            <div class="activity-details">
                                <div class="activity-title">${activity.title || activity.action}</div>
                                <div class="activity-meta">${timeStr}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            formatTimeAgo(dateStr) {
                if (!dateStr) return 'Fecha desconocida';

                const date = new Date(dateStr);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                if (diffMins < 1) return 'Justo ahora';
                if (diffMins < 60) return `Hace ${diffMins} min`;
                if (diffHours < 24) return `Hace ${diffHours} hora${diffHours > 1 ? 's' : ''}`;
                if (diffDays < 7) return `Hace ${diffDays} dia${diffDays > 1 ? 's' : ''}`;

                return date.toLocaleDateString('es-HN');
            }

            // Revoke a device/session
            async revokeDevice(deviceId) {
                if (!confirm('¬øEstas seguro de que quieres revocar el acceso de este dispositivo?')) {
                    return;
                }

                try {
                    const response = await fetch(`/api/user/devices/${deviceId}`, {
                        method: 'DELETE',
                        headers: window.getAuthHeaders()
                    });
                    const result = await response.json();

                    if (result.success) {
                        // Remove device from UI
                        const deviceElement = document.querySelector(`[data-device-id="${deviceId}"]`);
                        if (deviceElement) {
                            deviceElement.style.animation = 'fadeOut 0.3s ease';
                            setTimeout(() => deviceElement.remove(), 300);
                        }

                        this.showNotification('Dispositivo revocado exitosamente', 'success');

                        // Reload devices list
                        setTimeout(() => this.loadDevices(), 500);
                    } else {
                        this.showNotification(result.message || 'Error al revocar dispositivo', 'error');
                    }
                } catch (err) {
                    this.showNotification('Error de conexion', 'error');
                }
            }

            // 2FA Toggle - calls real API
            async toggle2FA() {
                if (this.securitySettings.twoFA) {
                    // Disable 2FA - show modal to enter code
                    this.show2FADisableModal();
                } else {
                    // Enable 2FA - show setup
                    this.show2FASetupModal();
                }
            }

            async show2FASetupModal() {
                const modal = document.createElement('div');
                modal.id = 'modal-2fa-setup';
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0, 0, 0, 0.8); display: flex; align-items: center;
                    justify-content: center; z-index: 1000; backdrop-filter: blur(8px);
                `;

                modal.innerHTML = `
                    <div style="background: var(--bg-card); backdrop-filter: blur(24px); border: 1px solid var(--border-accent);
                               border-radius: 20px; padding: 32px; max-width: 450px; width: 90%; position: relative;">
                        <button onclick="document.getElementById('modal-2fa-setup').remove()"
                                style="position: absolute; top: 16px; right: 16px; background: none; border: none;
                                       color: var(--text-secondary); font-size: 24px; cursor: pointer;">√ó</button>

                        <div style="text-align: center; margin-bottom: 24px;">
                            <div style="width: 64px; height: 64px; background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
                                 margin: 0 auto 16px; border-radius: 50%; display: flex; align-items: center;
                                 justify-content: center; font-size: 24px; color: var(--tanda-black);">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h2 style="color: var(--tanda-cyan); margin-bottom: 8px;">Configurar 2FA</h2>
                            <p style="color: var(--text-secondary);">Cargando codigo QR...</p>
                        </div>

                        <div id="qr-container" style="text-align: center; padding: 20px;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 32px; color: var(--tanda-cyan);"></i>
                        </div>

                        <div style="margin-top: 24px;">
                            <label style="color: var(--text-secondary); font-size: 14px; margin-bottom: 8px; display: block;">
                                Ingresa el codigo de tu app autenticadora:
                            </label>
                            <input type="text" id="totp-code-input" maxlength="6" placeholder="000000"
                                   style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border-accent);
                                          border-radius: 8px; color: var(--text-primary); font-size: 24px; text-align: center; letter-spacing: 8px;">
                        </div>

                        <button onclick="securityManager.verify2FASetup()"
                                style="width: 100%; margin-top: 16px; background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
                                       color: var(--tanda-black); border: none; padding: 14px; border-radius: 8px; cursor: pointer;
                                       font-weight: 600; font-size: 16px;">
                            Verificar y Activar
                        </button>
                    </div>
                `;

                document.body.appendChild(modal);

                // Call API to get QR code
                try {
                    const response = await fetch('/api/user/2fa/setup', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            ...window.getAuthHeaders()
                        }
                    });
                    const result = await response.json();

                    if (result.success && result.qrCode) {
                        document.getElementById('qr-container').innerHTML = `
                            <img loading="lazy" src="${result.qrCode}" alt="QR Code" style="max-width: 200px; border-radius: 8px; background: white; padding: 8px;">
                            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 12px;">
                                O ingresa manualmente: <code style="color: var(--tanda-cyan);">${result.secret || 'N/A'}</code>
                            </p>
                        `;
                        this.pending2FASecret = result.secret;
                    } else {
                        document.getElementById('qr-container').innerHTML = `
                            <p style="color: var(--error-color);">${result.message || 'Error al generar QR'}</p>
                        `;
                    }
                } catch (err) {
                    document.getElementById('qr-container').innerHTML = `
                        <p style="color: var(--error-color);">Error de conexion</p>
                    `;
                }
            }

            async verify2FASetup() {
                const code = document.getElementById('totp-code-input').value;
                if (!code || code.length !== 6) {
                    this.showNotification('Ingresa un codigo de 6 digitos', 'error');
                    return;
                }

                try {
                    const response = await fetch('/api/user/2fa/verify', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            ...window.getAuthHeaders()
                        },
                        body: JSON.stringify({ code })
                    });
                    const result = await response.json();

                    if (result.success) {
                        document.getElementById('modal-2fa-setup').remove();
                        this.securitySettings.twoFA = true;
                        this.saveLocalSettings();
                        this.update2FAToggle();
                        this.updateSecurityScore();

                        // Show backup codes if provided
                        if (result.backupCodes && result.backupCodes.length > 0) {
                            this.showBackupCodesModal(result.backupCodes);
                        } else {
                            this.showNotification('2FA activado exitosamente', 'success');
                        }
                    } else {
                        this.showNotification(result.message || 'Codigo incorrecto', 'error');
                    }
                } catch (err) {
                    this.showNotification('Error de conexion', 'error');
                }
            }

            showBackupCodesModal(codes) {
                const modal = document.createElement('div');
                modal.id = 'modal-backup-codes';
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0, 0, 0, 0.8); display: flex; align-items: center;
                    justify-content: center; z-index: 1000; backdrop-filter: blur(8px);
                `;

                modal.innerHTML = `
                    <div style="background: var(--bg-card); backdrop-filter: blur(24px); border: 1px solid var(--success-color);
                               border-radius: 20px; padding: 32px; max-width: 450px; width: 90%; position: relative;">

                        <div style="text-align: center; margin-bottom: 24px;">
                            <div style="width: 64px; height: 64px; background: var(--success-color);
                                 margin: 0 auto 16px; border-radius: 50%; display: flex; align-items: center;
                                 justify-content: center; font-size: 24px; color: white;">
                                <i class="fas fa-check"></i>
                            </div>
                            <h2 style="color: var(--success-color); margin-bottom: 8px;">2FA Activado</h2>
                            <p style="color: var(--text-secondary);">Guarda estos codigos de respaldo en un lugar seguro:</p>
                        </div>

                        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                                ${codes.map(code => `<code style="color: var(--tanda-cyan); font-size: 14px;">${code}</code>`).join('')}
                            </div>
                        </div>

                        <p style="color: var(--warning-color); font-size: 12px; margin-bottom: 16px;">
                            <i class="fas fa-exclamation-triangle"></i> Estos codigos solo se muestran una vez. Guardalos ahora.
                        </p>

                        <button onclick="document.getElementById('modal-backup-codes').remove()"
                                style="width: 100%; background: var(--success-color); color: white; border: none;
                                       padding: 14px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Entendido, los he guardado
                        </button>
                    </div>
                `;

                document.body.appendChild(modal);
            }

            show2FADisableModal() {
                const modal = document.createElement('div');
                modal.id = 'modal-2fa-disable';
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0, 0, 0, 0.8); display: flex; align-items: center;
                    justify-content: center; z-index: 1000; backdrop-filter: blur(8px);
                `;

                modal.innerHTML = `
                    <div style="background: var(--bg-card); backdrop-filter: blur(24px); border: 1px solid var(--warning-color);
                               border-radius: 20px; padding: 32px; max-width: 450px; width: 90%; position: relative;">
                        <button onclick="document.getElementById('modal-2fa-disable').remove()"
                                style="position: absolute; top: 16px; right: 16px; background: none; border: none;
                                       color: var(--text-secondary); font-size: 24px; cursor: pointer;">√ó</button>

                        <div style="text-align: center; margin-bottom: 24px;">
                            <div style="width: 64px; height: 64px; background: var(--warning-color);
                                 margin: 0 auto 16px; border-radius: 50%; display: flex; align-items: center;
                                 justify-content: center; font-size: 24px; color: white;">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <h2 style="color: var(--warning-color); margin-bottom: 8px;">Desactivar 2FA</h2>
                            <p style="color: var(--text-secondary);">Esto reducira la seguridad de tu cuenta</p>
                        </div>

                        <div style="margin-bottom: 24px;">
                            <label style="color: var(--text-secondary); font-size: 14px; margin-bottom: 8px; display: block;">
                                Ingresa tu codigo 2FA actual:
                            </label>
                            <input type="text" id="totp-disable-code" maxlength="6" placeholder="000000"
                                   style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border-accent);
                                          border-radius: 8px; color: var(--text-primary); font-size: 24px; text-align: center; letter-spacing: 8px;">
                        </div>

                        <div style="display: flex; gap: 12px;">
                            <button onclick="document.getElementById('modal-2fa-disable').remove()"
                                    style="flex: 1; background: transparent; color: var(--text-secondary);
                                           border: 1px solid var(--border-card); padding: 12px; border-radius: 8px; cursor: pointer;">
                                Cancelar
                            </button>
                            <button onclick="securityManager.confirm2FADisable()"
                                    style="flex: 1; background: var(--warning-color); color: white; border: none;
                                           padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                Desactivar
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
            }

            async confirm2FADisable() {
                const code = document.getElementById('totp-disable-code').value;
                if (!code || code.length !== 6) {
                    this.showNotification('Ingresa un codigo de 6 digitos', 'error');
                    return;
                }

                try {
                    const response = await fetch('/api/user/2fa/disable', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            ...window.getAuthHeaders()
                        },
                        body: JSON.stringify({ code })
                    });
                    const result = await response.json();

                    if (result.success) {
                        document.getElementById('modal-2fa-disable').remove();
                        this.securitySettings.twoFA = false;
                        this.saveLocalSettings();
                        this.update2FAToggle();
                        this.updateSecurityScore();
                        this.showNotification('2FA desactivado', 'warning');
                    } else {
                        this.showNotification(result.message || 'Codigo incorrecto', 'error');
                    }
                } catch (err) {
                    this.showNotification('Error de conexion', 'error');
                }
            }

            toggleSetting(settingName, element) {
                // For 2FA, use the API-based toggle
                if (settingName === 'twoFA') {
                    this.toggle2FA();
                    return;
                }

                // For other settings, use localStorage
                this.securitySettings[settingName] = !this.securitySettings[settingName];

                const toggle = element?.querySelector('.toggle-switch');
                const status = element?.querySelector('.setting-status');

                if (toggle) {
                    if (this.securitySettings[settingName]) {
                        toggle.classList.add('active');
                    } else {
                        toggle.classList.remove('active');
                    }
                }

                if (status) {
                    status.textContent = this.securitySettings[settingName] ? 'Habilitado' : 'Deshabilitado';
                    status.className = 'setting-status ' + (this.securitySettings[settingName] ? 'status-enabled' : 'status-disabled');
                }

                this.saveLocalSettings();
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed; top: 20px; right: 20px; z-index: 1001;
                    background: var(--bg-card); backdrop-filter: blur(24px);
                    border: 1px solid var(--border-accent); border-radius: 12px;
                    padding: 16px 20px; color: var(--text-primary);
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                    animation: slideInRight 0.3s ease;
                `;

                const iconClass = type === 'success' ? 'fa-check-circle' :
                                type === 'error' ? 'fa-times-circle' :
                                type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
                const iconColor = type === 'success' ? 'var(--success-color)' :
                                 type === 'error' ? 'var(--error-color)' :
                                 type === 'warning' ? 'var(--warning-color)' : 'var(--tanda-cyan)';

                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <i class="fas ${iconClass}" style="color: ${iconColor};"></i>
                        <span>${message}</span>
                    </div>
                `;

                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 5000);
            }
        }

        // Global functions
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load data for specific tabs
            if (tabName === 'devices') {
                securityManager.loadDevices();
            } else if (tabName === 'activity') {
                securityManager.loadActivity();
            }

        }

        function toggle2FA() {
            securityManager.toggle2FA();
        }

        function toggleEmailVerification() {
            const element = event.target.closest('.security-setting');
            securityManager.toggleSetting('emailVerification', element);
        }

        function toggleSMSVerification() {
            const element = event.target.closest('.security-setting');
            securityManager.toggleSetting('smsVerification', element);
        }

        function togglePublicProfile() {
            const element = event.target.closest('.security-setting');
            securityManager.toggleSetting('publicProfile', element);
        }

        function toggleActivityVisibility() {
            const element = event.target.closest('.security-setting');
            securityManager.toggleSetting('activityVisibility', element);
        }

        function toggleAutoBackup() {
            const element = event.target.closest('.security-setting');
            securityManager.toggleSetting('autoBackup', element);
        }

        function revokeDevice(deviceId) {
            securityManager.revokeDevice(deviceId);
        }

        function showEmergencyFreeze() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000; backdrop-filter: blur(8px);
            `;

            modal.innerHTML = `
                <div style="background: var(--bg-card); backdrop-filter: blur(24px); border: 2px solid var(--error-color);
                           border-radius: 20px; padding: 32px; max-width: 500px; width: 90%; position: relative;">
                    <button onclick="this.closest('div').parentElement.remove()"
                            style="position: absolute; top: 16px; right: 16px; background: none; border: none;
                                   color: var(--text-secondary); font-size: 24px; cursor: pointer;">√ó</button>

                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="width: 64px; height: 64px; background: var(--error-color);
                             margin: 0 auto 16px; border-radius: 50%; display: flex; align-items: center;
                             justify-content: center; font-size: 24px; color: white;">
                            <i class="fas fa-snowflake"></i>
                        </div>
                        <h2 style="color: var(--error-color); margin-bottom: 8px;">Congelar Cuenta</h2>
                        <p style="color: var(--text-secondary);">Esta accion suspendera temporalmente todas las actividades de tu cuenta.</p>
                    </div>

                    <div style="margin-bottom: 24px; padding: 16px; background: rgba(248, 113, 113, 0.1);
                         border-radius: 12px; border: 1px solid var(--error-color);">
                        <h4 style="color: var(--error-color); margin-bottom: 8px;">‚ö†Ô∏è Advertencia</h4>
                        <ul style="color: var(--text-secondary); font-size: 14px; line-height: 1.5; padding-left: 20px;">
                            <li>No podras realizar transacciones</li>
                            <li>El acceso a grupos sera suspendido</li>
                            <li>Solo funciones de visualizacion estaran disponibles</li>
                            <li>Deberas contactar soporte para reactivar</li>
                        </ul>
                    </div>

                    <div style="display: flex; gap: 12px;">
                        <button onclick="this.closest('div').parentElement.remove()"
                                style="flex: 1; background: transparent; color: var(--text-secondary);
                                       border: 1px solid var(--border-card); padding: 12px; border-radius: 8px; cursor: pointer;">
                            Cancelar
                        </button>
                        <button onclick="confirmFreeze()"
                                style="flex: 1; background: var(--error-color); color: white; border: none;
                                       padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Congelar Cuenta
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function confirmFreeze() {
            alert('Funcion de congelamiento de cuenta implementada. Contacta a soporte para reactivar.');
            document.querySelector('[style*="position: fixed"]').remove();
        }

        function configureTransactionLimits() {
            alert('Configuracion de limites de transacciones - Funcion en desarrollo');
        }

        function manageWhitelist() {
            alert('Gestion de lista blanca de direcciones - Funcion en desarrollo');
        }

        function showSeedPhrase() {
            alert('Visualizacion de frase semilla - Funcion en desarrollo (requiere verificacion adicional)');
        }

        function exportData() {
            alert('Exportacion de datos - Funcion en desarrollo');
        }

        // Initialize Security Manager when page loads
        let securityManager;
        document.addEventListener('DOMContentLoaded', () => {
            securityManager = new SecurityManager();
        });

        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes fadeOut {
                from { opacity: 1; transform: translateY(0); }
                to { opacity: 0; transform: translateY(-20px); }
            }
        `;
        document.head.appendChild(style);
    </script>
  <script nomodule>!function(){var e=document,t=e.createElement("script");if(!("noModule"in t)&&"onbeforeload"in t){var n=!1;e.addEventListener("beforeload",(function(e){if(e.target===t)n=!0;else if(!e.target.hasAttribute("nomodule")||!n)return;e.preventDefault()}),!0),t.type="module",t.src=".",e.head.appendChild(t),t.remove()}}();</script>
  <script nomodule crossorigin id="vite-legacy-polyfill" src="/assets/js/polyfills-legacy-YD97Sv6k.js"></script>
  <script nomodule crossorigin id="vite-legacy-entry" data-src="/assets/js/seguridad-legacy-CvD272dr.js">System.import(document.getElementById('vite-legacy-entry').getAttribute('data-src'))</script>
    <script src="js/components-loader.js?v=30.2"></script>
    <script src="js/header.js"></script>
    <script src="shared-components.js?v=7.20"></script>
</body>
</html>
