<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Tanda Web3 Ecosystem - Dashboard</title>
    <meta name="description" content="Dashboard principal La Tanda Web3 Ecosystem">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --tanda-cyan: #00D4AA;
            --tanda-cyan-light: #1DD3A7;
            --tanda-cyan-dark: #00B08C;
            --tanda-black: #000000;
            --tanda-dark: #0A0A0A;
            --tanda-gray: #1A1A1A;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --text-accent: #00F5D4;
            --bg-glass: rgba(0, 0, 0, 0.6);
            --border-primary: rgba(0, 212, 170, 0.1);
            --success-color: #4ECDC4;
            --warning-color: #FFD93D;
            --error-color: #FF6B6B;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 212, 170, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(29, 211, 167, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, var(--tanda-black) 0%, var(--tanda-dark) 30%, var(--tanda-black) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }
        
        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 25% 25%, rgba(0, 212, 170, 0.1) 0%, transparent 70%),
                radial-gradient(circle at 75% 75%, rgba(29, 211, 167, 0.05) 0%, transparent 70%);
            animation: backgroundPulse 8s ease-in-out infinite alternate;
            z-index: -1;
        }
        
        @keyframes backgroundPulse {
            0% { opacity: 0.3; }
            100% { opacity: 0.7; }
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header Section */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 32px;
            background: var(--bg-glass);
            backdrop-filter: blur(24px);
            border-radius: 20px;
            border: 1px solid var(--border-primary);
            margin-bottom: 32px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 100;
            transition: z-index 0.1s ease;
        }
        
        .header.user-menu-active {
            z-index: 2001;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .menu-toggle {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-primary);
            color: var(--text-primary);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: block; /* Always visible for testing and functionality */
            min-width: 40px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .menu-toggle:hover {
            background: rgba(0, 212, 170, 0.1);
            border-color: var(--tanda-cyan);
            color: var(--tanda-cyan);
            transform: scale(1.05);
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .logo {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            box-shadow: 0 0 30px rgba(0, 212, 170, 0.3);
        }
        
        .brand-info h1 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--tanda-cyan), var(--text-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }
        
        .brand-info p {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 400;
        }
        
        .welcome-message {
            margin-left: 32px;
            padding-left: 32px;
            border-left: 1px solid var(--border-primary);
        }
        
        .welcome-message h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .welcome-message p {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .network-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid var(--success-color);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            color: var(--success-color);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-color);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            top: 0;
            left: -320px;
            width: 320px;
            height: 100vh;
            background: var(--bg-glass);
            backdrop-filter: blur(24px);
            border-right: 1px solid var(--border-primary);
            z-index: 1000;
            transition: left 0.3s ease;
            overflow-y: auto;
        }
        
        .sidebar.open {
            left: 0;
        }
        
        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .sidebar-logo img {
            width: 40px;
            height: 40px;
            border-radius: 10px;
        }
        
        .sidebar-brand {
            font-size: 18px;
            font-weight: 600;
            background: linear-gradient(135deg, var(--tanda-cyan), var(--text-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .sidebar-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: color 0.3s ease;
        }
        
        .sidebar-close:hover {
            color: var(--text-primary);
        }
        
        .sidebar-nav {
            padding: 20px 0;
        }
        
        .nav-section {
            margin-bottom: 32px;
        }
        
        .nav-section-title {
            padding: 0 24px 12px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 24px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-item:hover {
            background: rgba(0, 212, 170, 0.1);
            color: var(--text-primary);
            border-right: 3px solid var(--tanda-cyan);
        }
        
        .nav-item.active {
            background: rgba(0, 212, 170, 0.15);
            color: var(--tanda-cyan);
            border-right: 3px solid var(--tanda-cyan);
        }
        
        .nav-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }
        
        .nav-label {
            font-size: 14px;
            font-weight: 500;
        }
        
        .nav-badge {
            margin-left: auto;
            background: var(--tanda-cyan);
            color: var(--tanda-black);
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }
        
        /* Sidebar Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .user-profile:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--tanda-cyan);
        }
        
        .user-profile.active {
            background: rgba(0, 212, 170, 0.1);
            border-color: var(--tanda-cyan);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--tanda-black);
        }
        
        .user-info h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .user-info p {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* User Dropdown Menu */
        .user-dropdown {
            position: fixed;
            width: 280px;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(24px);
            border: 2px solid var(--tanda-cyan);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6), 
                        0 0 0 1px rgba(0, 212, 170, 0.2),
                        0 0 20px rgba(0, 212, 170, 0.3);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 10000;
        }
        
        .user-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .user-dropdown-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-primary);
            text-align: center;
        }
        
        .user-dropdown-avatar {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 24px;
            color: var(--tanda-black);
            margin: 0 auto 12px;
        }
        
        .user-dropdown-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .user-dropdown-email {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .user-dropdown-role {
            display: inline-block;
            background: rgba(0, 212, 170, 0.1);
            color: var(--tanda-cyan);
            font-size: 10px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .user-dropdown-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-primary);
        }
        
        .user-dropdown-stat {
            text-align: center;
        }
        
        .user-dropdown-stat-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--tanda-cyan);
            margin-bottom: 2px;
        }
        
        .user-dropdown-stat-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .user-dropdown-menu {
            padding: 12px 0;
        }
        
        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .user-dropdown-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }
        
        .user-dropdown-item.danger {
            color: var(--error-color);
        }
        
        .user-dropdown-item.danger:hover {
            background: rgba(255, 107, 107, 0.1);
            color: var(--error-color);
        }
        
        .user-dropdown-icon {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }
        
        .user-dropdown-label {
            font-size: 14px;
            font-weight: 500;
        }
        
        .user-dropdown-badge {
            margin-left: auto;
            background: var(--tanda-cyan);
            color: var(--tanda-black);
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 8px;
            min-width: 16px;
            text-align: center;
        }
        
        .user-dropdown-divider {
            height: 1px;
            background: var(--border-primary);
            margin: 8px 0;
        }
        
        /* User Menu Overlay */
        .user-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.05);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .user-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--bg-glass);
            backdrop-filter: blur(24px);
            border-radius: 16px;
            border: 1px solid var(--border-primary);
            padding: 24px;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 50px -12px rgba(0, 212, 170, 0.2);
            border-color: var(--tanda-cyan);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: rgba(0, 212, 170, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .stat-trend {
            font-size: 12px;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 8px;
        }
        
        .trend-up {
            background: rgba(78, 205, 196, 0.1);
            color: var(--success-color);
        }
        
        .trend-down {
            background: rgba(255, 107, 107, 0.1);
            color: var(--error-color);
        }
        
        .trend-neutral {
            background: rgba(255, 217, 61, 0.1);
            color: var(--warning-color);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(135deg, var(--text-primary), var(--tanda-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }
        
        /* Main Content Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }
        
        /* Features Grid */
        .features-section {
            background: var(--bg-glass);
            backdrop-filter: blur(24px);
            border-radius: 20px;
            border: 1px solid var(--border-primary);
            padding: 32px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: rgba(0, 212, 170, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--tanda-cyan);
            transform: translateY(-2px);
        }
        
        .feature-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }
        
        .feature-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .feature-description {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        
        /* Activity Panel */
        .activity-panel {
            background: var(--bg-glass);
            backdrop-filter: blur(24px);
            border-radius: 20px;
            border: 1px solid var(--border-primary);
            padding: 24px;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .activity-icon.success {
            background: rgba(78, 205, 196, 0.1);
            color: var(--success-color);
        }
        
        .activity-icon.info {
            background: rgba(0, 212, 170, 0.1);
            color: var(--tanda-cyan);
        }
        
        .activity-icon.warning {
            background: rgba(255, 217, 61, 0.1);
            color: var(--warning-color);
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .activity-description {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .activity-time {
            font-size: 12px;
            color: var(--text-secondary);
            flex-shrink: 0;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 16px;
            margin-top: 32px;
        }
        
        .btn-primary {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
            border: none;
            border-radius: 12px;
            color: var(--tanda-black);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 170, 0.3);
        }
        
        .btn-secondary {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--tanda-cyan);
            transform: translateY(-1px);
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .welcome-message {
                margin-left: 0;
                padding-left: 0;
                border-left: none;
                border-top: 1px solid var(--border-primary);
                padding-top: 20px;
            }
            
            .menu-toggle {
                display: flex; /* Keep consistent with main style */
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 15px;
            }
            
            .header {
                padding: 20px;
                flex-direction: row;
                text-align: left;
            }
            
            .header-left {
                flex-direction: row;
                gap: 15px;
            }
            
            .welcome-message {
                margin-left: 0;
                padding-left: 0;
                border-left: none;
                border-top: none;
                padding-top: 0;
            }
            
            .header-right {
                flex-direction: column;
                gap: 10px;
            }
            
            .quick-stats {
                grid-template-columns: 1fr;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .menu-toggle {
                display: block;
                order: -1;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
    
    <!-- User Menu Overlay -->
    <div class="user-menu-overlay" id="userMenuOverlay" onclick="toggleUserMenu()"></div>
    
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <img src="Darkfield 2 new latanda logo.jpg" alt="La Tanda">
                <span class="sidebar-brand">La Tanda</span>
            </div>
            <button class="sidebar-close" onclick="toggleSidebar()">×</button>
        </div>
        
        <div class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Principal</div>
                <div class="nav-item active" onclick="navigateToSection('home')">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-label">Dashboard</span>
                </div>
                <div class="nav-item" onclick="navigateToSection('wallet')">
                    <span class="nav-icon">💰</span>
                    <span class="nav-label">Mi Wallet</span>
                    <span class="nav-badge">NEW</span>
                </div>
                <div class="nav-item" onclick="navigateToSection('transactions')">
                    <span class="nav-icon">💳</span>
                    <span class="nav-label">Transacciones</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Tandas & Grupos</div>
                <div class="nav-item" onclick="navigateToSection('groups')">
                    <span class="nav-icon">👥</span>
                    <span class="nav-label">Mis Grupos</span>
                    <span class="nav-badge">3</span>
                </div>
                <div class="nav-item" onclick="navigateToSection('create-group')">
                    <span class="nav-icon">➕</span>
                    <span class="nav-label">Crear Grupo</span>
                </div>
                <div class="nav-item" onclick="navigateToSection('invitations')">
                    <span class="nav-icon">📧</span>
                    <span class="nav-label">Invitaciones</span>
                    <span class="nav-badge">2</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">DeFi & Web3</div>
                <div class="nav-item" onclick="navigateToSection('trading')">
                    <span class="nav-icon">📊</span>
                    <span class="nav-label">Trading</span>
                </div>
                <div class="nav-item" onclick="navigateToSection('staking')">
                    <span class="nav-icon">🏦</span>
                    <span class="nav-label">Staking</span>
                </div>
                <div class="nav-item" onclick="navigateToSection('nft')">
                    <span class="nav-icon">🎨</span>
                    <span class="nav-label">NFT Marketplace</span>
                </div>
                <div class="nav-item" onclick="navigateToSection('dao')">
                    <span class="nav-icon">🗳️</span>
                    <span class="nav-label">Governance</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Configuración</div>
                <div class="nav-item" onclick="navigateToSection('profile')">
                    <span class="nav-icon">👤</span>
                    <span class="nav-label">Mi Perfil</span>
                </div>
                <div class="nav-item" onclick="navigateToSection('kyc')">
                    <span class="nav-icon">📋</span>
                    <span class="nav-label">Verificación KYC</span>
                </div>
                <div class="nav-item" onclick="navigateToSection('security')">
                    <span class="nav-icon">🔒</span>
                    <span class="nav-label">Seguridad</span>
                </div>
                <div class="nav-item" onclick="navigateToSection('settings')">
                    <span class="nav-icon">⚙️</span>
                    <span class="nav-label">Configuración</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle" onclick="toggleSidebar()" title="Abrir/Cerrar Menú">☰</button>
                <div class="logo-section" onclick="dashboard.showWelcomeMessage()" style="cursor: pointer;" title="Ir al inicio">
                    <img src="Darkfield 2 new latanda logo.jpg" alt="La Tanda" class="logo">
                    <div class="brand-info">
                        <h1>La Tanda</h1>
                        <p>Web3 Ecosystem</p>
                    </div>
                </div>
                
                <div class="welcome-message">
                    <h2 id="welcomeTitle">¡Bienvenido al Ecosistema!</h2>
                    <p id="welcomeSubtitle">Tu plataforma financiera descentralizada</p>
                </div>
            </div>
            
            <div class="header-right">
                <div class="network-status" onclick="dashboard.showNetworkInfo()" style="cursor: pointer;" title="Ver información de la red">
                    <div class="status-dot" style="background: #00ff88; box-shadow: 0 0 10px rgba(0,255,136,0.5);"></div>
                    <span>Honduras Network</span>
                </div>
                
                <div class="user-profile" onclick="toggleUserMenu()" id="userProfile">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-info">
                        <h3 id="userName">Usuario</h3>
                        <p id="userRole">Miembro</p>
                    </div>
                    
                    <!-- User Dropdown Menu -->
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-dropdown-header">
                            <div class="user-dropdown-avatar" id="dropdownAvatar">U</div>
                            <div class="user-dropdown-name" id="dropdownName">Usuario Demo</div>
                            <div class="user-dropdown-email" id="dropdownEmail">demo@latanda.com</div>
                            <div class="user-dropdown-role" id="dropdownRole">Usuario Demo</div>
                        </div>
                        
                        <div class="user-dropdown-stats">
                            <div class="user-dropdown-stat">
                                <div class="user-dropdown-stat-value" id="dropdownBalance">$0.00</div>
                                <div class="user-dropdown-stat-label">Balance</div>
                            </div>
                            <div class="user-dropdown-stat">
                                <div class="user-dropdown-stat-value" id="dropdownPoints">100</div>
                                <div class="user-dropdown-stat-label">Puntos LTD</div>
                            </div>
                        </div>
                        
                        <div class="user-dropdown-menu">
                            <div class="user-dropdown-item" onclick="navigateToSection('profile')">
                                <span class="user-dropdown-icon">👤</span>
                                <span class="user-dropdown-label">Mi Perfil</span>
                            </div>
                            
                            <div class="user-dropdown-item" onclick="navigateToSection('wallet')">
                                <span class="user-dropdown-icon">💰</span>
                                <span class="user-dropdown-label">Mi Wallet</span>
                                <span class="user-dropdown-badge">NEW</span>
                            </div>
                            
                            <div class="user-dropdown-item" onclick="navigateToSection('kyc')">
                                <span class="user-dropdown-icon">📋</span>
                                <span class="user-dropdown-label">Verificación KYC</span>
                                <span class="user-dropdown-badge">!</span>
                            </div>
                            
                            <div class="user-dropdown-divider"></div>
                            
                            <div class="user-dropdown-item" onclick="navigateToSection('security')">
                                <span class="user-dropdown-icon">🔒</span>
                                <span class="user-dropdown-label">Seguridad</span>
                            </div>
                            
                            <div class="user-dropdown-item" onclick="navigateToSection('settings')">
                                <span class="user-dropdown-icon">⚙️</span>
                                <span class="user-dropdown-label">Configuración</span>
                            </div>
                            
                            <div class="user-dropdown-item" onclick="toggleNotifications()" id="notificationsItem">
                                <span class="user-dropdown-icon" id="notificationsIcon">🔔</span>
                                <span class="user-dropdown-label" id="notificationsLabel">Notificaciones</span>
                            </div>
                            
                            <div class="user-dropdown-divider"></div>
                            
                            <div class="user-dropdown-item" onclick="showHelp()">
                                <span class="user-dropdown-icon">❓</span>
                                <span class="user-dropdown-label">Ayuda & Soporte</span>
                            </div>
                            
                            <div class="user-dropdown-item danger" onclick="logout()">
                                <span class="user-dropdown-icon">🚪</span>
                                <span class="user-dropdown-label">Cerrar Sesión</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Quick Stats -->
        <section class="quick-stats">
            <div class="stat-card" onclick="dashboard.showBalanceDetails()" style="cursor: pointer;" title="Ver desglose completo del balance">
                <div class="stat-header">
                    <div class="stat-icon">💰</div>
                    <div class="stat-trend trend-up">+12.5%</div>
                </div>
                <div class="stat-value" id="walletBalance">$15,847.32</div>
                <div class="stat-label">Balance Total</div>
            </div>
            
            <div class="stat-card" onclick="dashboard.showTandasDetails()" style="cursor: pointer;" title="Ver tandas activas y su estado">
                <div class="stat-header">
                    <div class="stat-icon">👥</div>
                    <div class="stat-trend trend-up">+3</div>
                </div>
                <div class="stat-value" id="activeGroups">5</div>
                <div class="stat-label">Tandas Activas</div>
            </div>
            
            <div class="stat-card" onclick="dashboard.showKYCDetails()" style="cursor: pointer;" title="Ver estado de verificación KYC">
                <div class="stat-header">
                    <div class="stat-icon">🎯</div>
                    <div class="stat-trend trend-neutral">Verificado</div>
                </div>
                <div class="stat-value" id="kycStatus">✅ Admin</div>
                <div class="stat-label">Estado KYC</div>
            </div>
            
            <div class="stat-card" onclick="dashboard.showLTDDetails()" style="cursor: pointer;" title="Ver detalles de tokens LTD">
                <div class="stat-header">
                    <div class="stat-icon">🏆</div>
                    <div class="stat-trend trend-up">+50</div>
                </div>
                <div class="stat-value" id="rewardPoints">2,500</div>
                <div class="stat-label">Puntos LTD</div>
            </div>
        </section>
        
        <!-- Main Content -->
        <div class="main-grid">
            <!-- Features Section -->
            <section class="features-section">
                <h2 class="section-title">
                    <div class="section-icon">🚀</div>
                    Funcionalidades del Ecosistema
                </h2>
                
                <div class="features-grid">
                    <div class="feature-card" onclick="navigateToSection('kyc')">
                        <div class="feature-icon">📋</div>
                        <h3 class="feature-title">Registro KYC</h3>
                        <p class="feature-description">Completa tu verificación de identidad para acceder a todas las funcionalidades</p>
                    </div>
                    
                    <div class="feature-card" onclick="navigateToSection('wallet')">
                        <div class="feature-icon">💳</div>
                        <h3 class="feature-title">Wallet Web3</h3>
                        <p class="feature-description">Gestiona tus criptomonedas y tokens LTD de forma segura</p>
                    </div>
                    
                    <div class="feature-card" onclick="navigateToSection('groups')">
                        <div class="feature-icon">🎯</div>
                        <h3 class="feature-title">Tandas & Grupos</h3>
                        <p class="feature-description">Únete o crea grupos de ahorro cooperativo</p>
                    </div>
                    
                    <div class="feature-card" onclick="navigateToSection('marketplace')">
                        <div class="feature-icon">🛍️</div>
                        <h3 class="feature-title">Marketplace NFT</h3>
                        <p class="feature-description">Comercia NFTs y activos digitales del ecosistema</p>
                    </div>
                    
                    <div class="feature-card" onclick="navigateToSection('dashboard')">
                        <div class="feature-icon">📊</div>
                        <h3 class="feature-title">DeFi Dashboard</h3>
                        <p class="feature-description">Trading, staking y analytics avanzados</p>
                    </div>
                    
                    <div class="feature-card" onclick="navigateToSection('tokenomics')">
                        <div class="feature-icon">🪙</div>
                        <h3 class="feature-title">LTD Tokenomics</h3>
                        <p class="feature-description">Governance, rewards y economics del token</p>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn-primary" onclick="quickStart()">
                        🚀 Guía de Inicio Rápido
                    </button>
                    <button class="btn-secondary" onclick="navigateToSection('dashboard')">
                        📊 Ver Dashboard Completo
                    </button>
                </div>
            </section>
            
            <!-- Activity Panel -->
            <section class="activity-panel">
                <h2 class="section-title">
                    <div class="section-icon">📈</div>
                    Actividad Reciente
                </h2>
                
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon success">✅</div>
                        <div class="activity-content">
                            <div class="activity-title">Cuenta creada exitosamente</div>
                            <div class="activity-description">Bienvenido al ecosistema La Tanda</div>
                        </div>
                        <div class="activity-time">Ahora</div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon info">🔐</div>
                        <div class="activity-content">
                            <div class="activity-title">Sesión iniciada</div>
                            <div class="activity-description">Acceso seguro verificado</div>
                        </div>
                        <div class="activity-time">Hace 1m</div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon warning">⚠️</div>
                        <div class="activity-content">
                            <div class="activity-title">KYC pendiente</div>
                            <div class="activity-description">Completa tu verificación de identidad</div>
                        </div>
                        <div class="activity-time">Pendiente</div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon info">🎁</div>
                        <div class="activity-content">
                            <div class="activity-title">Bonus de bienvenida</div>
                            <div class="activity-description">100 puntos LTD otorgados</div>
                        </div>
                        <div class="activity-time">Hace 2m</div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // Home Dashboard System
        class HomeDashboard {
            constructor() {
                // Initialize with real data management
                this.apiBase = window.location.hostname === 'localhost' ? 'http://localhost:3000' : 'https://api.latanda.online';
                this.user = null;
                this.stats = null;
                this.tandas = [];
                this.transactions = [];
                this.ltdData = null;
                
                this.init();
            }

            async init() {
                console.log('🚀 Initializing Home Dashboard...');
                
                try {
                    // Show loading state
                    this.showLoadingState();
                    
                    // Load and validate data
                    await this.loadUserData();
                    
                    // Validate data integrity
                    if (!this.validateAndBackupData()) {
                        console.warn('⚠️ Data validation failed, using backup');
                    }
                    
                    // Setup event listeners
                    this.setupEventListeners();
                    
                    // Initialize UI
                    this.updateUI();
                    this.updateWelcomeMessage();
                    this.updateUserProfile();
                    this.updateUserDropdown();
                    
                    // Hide loading state
                    this.hideLoadingState();
                    
                    // Set up periodic sync
                    this.setupPeriodicSync();
                    
                    // Start demo simulation only once
                    this.simulateDataUpdates();
                    
                    console.log('✅ Home Dashboard initialized successfully');
                    
                } catch (error) {
                    console.error('❌ Dashboard initialization failed:', error);
                    this.hideLoadingState();
                    this.showNotification('❌ Error', 'Error inicializando dashboard');
                }
            }

            showLoadingState() {
                const loadingOverlay = document.createElement('div');
                loadingOverlay.id = 'dashboardLoading';
                loadingOverlay.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(15, 23, 42, 0.9); display: flex; align-items: center;
                    justify-content: center; z-index: 2000; backdrop-filter: blur(10px);
                `;
                
                loadingOverlay.innerHTML = `
                    <div style="text-align: center; color: white;">
                        <div style="width: 50px; height: 50px; border: 3px solid rgba(0,255,255,0.3);
                                    border-top: 3px solid #00FFFF; border-radius: 50%;
                                    animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">Cargando Dashboard</div>
                        <div style="font-size: 14px; color: rgba(255,255,255,0.7);">Sincronizando datos...</div>
                    </div>
                    <style>
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                    </style>
                `;
                
                document.body.appendChild(loadingOverlay);
            }

            hideLoadingState() {
                const loadingOverlay = document.getElementById('dashboardLoading');
                if (loadingOverlay) {
                    loadingOverlay.remove();
                }
            }

            setupPeriodicSync() {
                // Sync data every 5 minutes
                setInterval(() => {
                    if (!localStorage.getItem('latanda_demo_mode')) {
                        this.syncWithAPI();
                    }
                }, 5 * 60 * 1000);
                
                // Save data every minute (for data persistence)
                setInterval(() => {
                    if (this.validateAndBackupData()) {
                        this.saveData();
                    }
                }, 60 * 1000);
                
                console.log('⏰ Periodic sync and backup scheduled');
            }

            showWelcomeMessage() {
                this.showNotification('¡Bienvenido!', `Hola ${this.user.name}, tienes acceso completo al sistema`);
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            showNetworkInfo() {
                const networkInfo = `
                    🌐 Red: Honduras Network
                    ✅ Estado: Conectado
                    ⚡ Latencia: 12ms
                    🔗 Bloques: 2,847,293
                    💰 Gas Price: 0.8 Gwei
                    🏛️ Validadores: 247 activos
                `;
                this.showNotification('Información de Red', networkInfo);
            }

            showBalanceDetails() {
                const balanceDetails = `
💰 DESGLOSE DE BALANCE TOTAL: $15,847.32

┌─ ACTIVOS LÍQUIDOS ─────────────────┐
│ 💵 Efectivo en Wallet: $8,423.50   │
│ 🏦 En Tandas Activas: $5,890.00    │
│ 🔒 Fondos Bloqueados: $1,200.00    │
│ ⚡ Intereses Ganados: $333.82      │
└────────────────────────────────────┘

┌─ TOKENS & CRIPTO ──────────────────┐
│ 🪙 LTD Tokens: 2,500 ($1,875.00)   │
│ ₿ Bitcoin: 0.0234 ($978.45)        │
│ Ⓔ Ethereum: 1.23 ($2,156.78)      │
└────────────────────────────────────┘

┌─ MOVIMIENTOS RECIENTES ────────────┐
│ ↗️ +$450.00 - Pago Tanda #247      │
│ ↘️ -$200.00 - Retiro ATM           │
│ ↗️ +$125.50 - Intereses Staking    │
└────────────────────────────────────┘

🔍 Ver detalles completos  📊 Generar reporte  💳 Retirar fondos
                `;
                this.showDetailedModal('💰 Balance Total', balanceDetails, [
                    { text: '🔍 Ver Detalles', action: () => this.navigateToSection('wallet') },
                    { text: '📊 Generar Reporte', action: () => this.generateBalanceReport() },
                    { text: '💳 Retirar Fondos', action: () => this.showWithdrawModal() }
                ]);
            }

            showTandasDetails() {
                const tandasDetails = `
👥 TANDAS ACTIVAS: 5 Grupos

┌─ COORDINANDO (3) ──────────────────┐
│ 🏆 "Ahorro Familiar 2024"          │
│    • 12/15 participantes           │
│    • $450/mes • Faltan 3 pagos     │
│    • Tu turno: #8 (Nov 2024)       │
│                                    │
│ 💼 "Empresarios Unidos"            │
│    • 8/10 participantes            │
│    • $800/mes • Faltan 7 pagos     │
│    • Tu turno: #1 (Ya cobrado)     │
│                                    │
│ 🎓 "Estudiantes Graduados"         │
│    • 6/6 participantes             │
│    • $200/mes • Faltan 2 pagos     │
│    • Tu turno: #4 (Dic 2024)       │
└────────────────────────────────────┘

┌─ PARTICIPANDO (2) ─────────────────┐
│ 🏠 "Vecinos La Colonia"            │
│    • Coordinador: María García     │
│    • $300/mes • Pagado al día      │
│    • Tu turno: #7 (Ene 2025)       │
│                                    │
│ 💰 "Inversores Pro"                │
│    • Coordinador: Carlos López     │
│    • $1,000/mes • Pagado al día    │
│    • Tu turno: #5 (Oct 2024)       │
└────────────────────────────────────┘
                `;
                this.showDetailedModal('👥 Tandas Activas', tandasDetails, [
                    { text: '📈 Ver Análisis', action: () => this.showPerformanceAnalysis() },
                    { text: '⚠️ Gestionar Alertas', action: () => this.managePaymentAlerts() },
                    { text: '➕ Crear Nueva Tanda', action: () => this.navigateToSection('create-group') }
                ]);
            }

            showKYCDetails() {
                const kycDetails = `
📋 ESTADO DE VERIFICACIÓN KYC

┌─ ESTADO ACTUAL ────────────────────┐
│ ✅ VERIFICADO COMPLETO             │
│ 🛡️ Nivel: Administrador Sistema    │
│ 📅 Verificado: 15 Enero 2024       │
│ 🔄 Próxima revisión: 15 Ene 2025   │
└────────────────────────────────────┘

┌─ DOCUMENTOS VERIFICADOS ───────────┐
│ ✅ Identidad Nacional              │
│ ✅ Comprobante de Ingresos         │
│ ✅ Comprobante de Domicilio        │
│ ✅ Selfie con Documento            │
│ ✅ Verificación Biométrica         │
│ ✅ Referencias Comerciales         │
└────────────────────────────────────┘

┌─ PRIVILEGIOS ADMIN ────────────────┐
│ 🔑 Acceso total al sistema         │
│ 👥 Gestión de usuarios             │
│ 💰 Límites de transacción: Sin lím │
│ 🌍 Acceso internacional            │
│ 🏦 Funciones bancarias avanzadas   │
└────────────────────────────────────┘
                `;
                this.showDetailedModal('📋 Estado KYC', kycDetails, [
                    { text: '📄 Descargar Certificado', action: () => this.downloadKYCCertificate() },
                    { text: '🔄 Renovar Verificación', action: () => this.renewKYCVerification() },
                    { text: '⚙️ Configurar Alertas', action: () => this.configureKYCAlerts() }
                ]);
            }

            showLTDDetails() {
                const ltdDetails = `
🪙 PUNTOS LTD TOKENS: 2,500 LTD

┌─ RESUMEN DE TOKENS ────────────────┐
│ 💰 Valor actual: $1,875.00         │
│ 📈 Precio LTD: $0.75               │
│ 📊 Cambio 24h: +5.2% ↗️           │
│ 🏆 Ranking: Top 1% holders         │
└────────────────────────────────────┘

┌─ DISTRIBUCIÓN ─────────────────────┐
│ 🔒 En Staking: 1,800 LTD (72%)     │
│ 💰 Líquidos: 500 LTD (20%)         │
│ 🎁 En Rewards: 200 LTD (8%)        │
└────────────────────────────────────┘

┌─ GANANCIAS STAKING ────────────────┐
│ 📈 APY Actual: 24.5%               │
│ 💵 Ganado hoy: +12.3 LTD           │
│ 📅 Ganado este mes: +347.8 LTD     │
│ 🏦 Total acumulado: +1,248.7 LTD   │
└────────────────────────────────────┘

┌─ ACTIVIDADES RECIENTES ────────────┐
│ ↗️ +50 LTD - Reward por coordinación│
│ ↗️ +25 LTD - Staking diario         │
│ ↘️ -100 LTD - Pago tanda #247       │
│ ↗️ +15 LTD - Referido nuevo usuario │
└────────────────────────────────────┘
                `;
                this.showDetailedModal('🪙 Puntos LTD', ltdDetails, [
                    { text: '🔄 Hacer Staking', action: () => this.openStakingModal() },
                    { text: '💱 Intercambiar', action: () => this.openExchangeModal() },
                    { text: '📊 Ver Gráfico', action: () => this.showPriceChart() },
                    { text: '🎁 Reclamar Rewards', action: () => this.claimRewards() }
                ]);
            }

            async loadUserData() {
                try {
                    // Load user data from localStorage first (offline support)
                    const savedUser = localStorage.getItem('latanda_user');
                    const savedStats = localStorage.getItem('latanda_stats');
                    const savedTandas = localStorage.getItem('latanda_tandas');
                    const savedTransactions = localStorage.getItem('latanda_transactions');
                    
                    if (savedUser) {
                        this.user = JSON.parse(savedUser);
                    } else {
                        // Initialize new admin user if no data exists
                        this.user = {
                            id: 'admin_001',
                            name: 'Administrador Sistema',
                            role: 'admin', 
                            email: 'admin@latanda.com',
                            avatar: 'A',
                            balance: 15847.32,
                            ltdTokens: 2500,
                            joinDate: new Date().toISOString().split('T')[0],
                            walletAddress: '0x742d35...8b2f',
                            phone: '+504 9999-9999',
                            kycStatus: 'verified',
                            kycLevel: 'admin'
                        };
                        localStorage.setItem('latanda_user', JSON.stringify(this.user));
                    }

                    // Load stats
                    if (savedStats) {
                        this.stats = JSON.parse(savedStats);
                    } else {
                        this.stats = {
                            balance: this.user.balance,
                            activeTandas: 5,
                            completedTandas: 12,
                            totalEarnings: 3247.85,
                            kycStatus: 'verified',
                            ltdTokens: this.user.ltdTokens,
                            stakingRewards: 347.82,
                            lastUpdated: new Date().toISOString()
                        };
                        localStorage.setItem('latanda_stats', JSON.stringify(this.stats));
                    }

                    // Load tandas data
                    if (savedTandas) {
                        this.tandas = JSON.parse(savedTandas);
                    } else {
                        this.initializeTandasData();
                    }

                    // Load transactions
                    if (savedTransactions) {
                        this.transactions = JSON.parse(savedTransactions);
                    } else {
                        this.initializeTransactionsData();
                    }

                    // Try to sync with API if available
                    await this.syncWithAPI();
                    
                    this.updateWelcomeMessage();
                    this.updateUserProfile();
                    this.updateDashboardStats();
                    
                } catch (error) {
                    console.error('Error loading user data:', error);
                    this.showNotification('⚠️ Error', 'Error cargando datos del usuario');
                }

            }

            initializeTandasData() {
                this.tandas = [
                    {
                        id: 'tanda_001',
                        name: 'Ahorro Familiar 2024',
                        type: 'coordinando',
                        participants: 12,
                        maxParticipants: 15,
                        monthlyAmount: 450,
                        remainingPayments: 3,
                        myTurn: 8,
                        nextTurnDate: '2024-11-15',
                        status: 'active',
                        totalAmount: 6750,
                        collectedAmount: 5400
                    },
                    {
                        id: 'tanda_002', 
                        name: 'Empresarios Unidos',
                        type: 'coordinando',
                        participants: 8,
                        maxParticipants: 10,
                        monthlyAmount: 800,
                        remainingPayments: 7,
                        myTurn: 1,
                        nextTurnDate: 'completed',
                        status: 'active',
                        totalAmount: 8000,
                        collectedAmount: 800
                    },
                    {
                        id: 'tanda_003',
                        name: 'Estudiantes Graduados',
                        type: 'coordinando',
                        participants: 6,
                        maxParticipants: 6,
                        monthlyAmount: 200,
                        remainingPayments: 2,
                        myTurn: 4,
                        nextTurnDate: '2024-12-15',
                        status: 'active',
                        totalAmount: 1200,
                        collectedAmount: 800
                    },
                    {
                        id: 'tanda_004',
                        name: 'Vecinos La Colonia',
                        type: 'participando',
                        coordinator: 'María García',
                        monthlyAmount: 300,
                        myTurn: 7,
                        nextTurnDate: '2025-01-15',
                        status: 'active',
                        paymentStatus: 'up_to_date'
                    },
                    {
                        id: 'tanda_005',
                        name: 'Inversores Pro',
                        type: 'participando',
                        coordinator: 'Carlos López',
                        monthlyAmount: 1000,
                        myTurn: 5,
                        nextTurnDate: '2024-10-15',
                        status: 'active',
                        paymentStatus: 'up_to_date'
                    }
                ];
                localStorage.setItem('latanda_tandas', JSON.stringify(this.tandas));
            }

            initializeTransactionsData() {
                this.transactions = [
                    {
                        id: 'tx_001',
                        type: 'income',
                        amount: 450.00,
                        description: 'Pago Tanda #247 - Ahorro Familiar',
                        date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                        category: 'tanda_payment'
                    },
                    {
                        id: 'tx_002',
                        type: 'expense',
                        amount: 200.00,
                        description: 'Retiro ATM - Banco Atlántida',
                        date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                        category: 'withdrawal'
                    },
                    {
                        id: 'tx_003',
                        type: 'income',
                        amount: 125.50,
                        description: 'Intereses Staking LTD',
                        date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                        category: 'staking_rewards'
                    },
                    {
                        id: 'tx_004',
                        type: 'income',
                        amount: 50.00,
                        description: 'Reward por coordinación - Tanda Empresarios',
                        date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                        category: 'coordination_reward'
                    },
                    {
                        id: 'tx_005',
                        type: 'expense',
                        amount: 100.00,
                        description: 'Pago mensual Tanda #247',
                        date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                        category: 'tanda_payment'
                    }
                ];
                localStorage.setItem('latanda_transactions', JSON.stringify(this.transactions));
            }

            async syncWithAPI() {
                try {
                    // Check if we're in demo mode or production
                    const isDemoMode = localStorage.getItem('latanda_demo_mode') === 'true';
                    
                    if (isDemoMode) {
                        console.log('📱 Demo mode: Using local data only');
                        return;
                    }
                    
                    // Try to sync with production API
                    const authToken = localStorage.getItem('latanda_auth_token');
                    if (!authToken) {
                        console.log('⚠️ No auth token, skipping API sync');
                        return;
                    }
                    
                    // Sync user profile
                    const userResponse = await this.apiRequest(`/api/users/${this.user.id}`, 'GET');
                    if (userResponse.success && userResponse.data) {
                        // Merge server data with local data (server takes priority)
                        this.user = { ...this.user, ...userResponse.data };
                        console.log('✅ User data synced with server');
                    }
                    
                    // Sync financial stats
                    const statsResponse = await this.apiRequest(`/api/users/${this.user.id}/stats`, 'GET');
                    if (statsResponse.success && statsResponse.data) {
                        this.stats = { ...this.stats, ...statsResponse.data };
                        console.log('✅ Stats synced with server');
                    }
                    
                    // Sync tandas data
                    const tandasResponse = await this.apiRequest(`/api/users/${this.user.id}/tandas`, 'GET');
                    if (tandasResponse.success && tandasResponse.data) {
                        this.tandas = tandasResponse.data;
                        console.log('✅ Tandas synced with server');
                    }
                    
                    // Sync transactions
                    const transactionsResponse = await this.apiRequest(`/api/users/${this.user.id}/transactions`, 'GET');
                    if (transactionsResponse.success && transactionsResponse.data) {
                        this.transactions = transactionsResponse.data;
                        console.log('✅ Transactions synced with server');
                    }
                    
                    // Save synced data locally
                    this.saveData();
                    
                } catch (error) {
                    console.log('⚠️ API sync failed, using local data only:', error.message);
                    // Set demo mode if API is unavailable
                    localStorage.setItem('latanda_demo_mode', 'true');
                }
            }

            async apiRequest(endpoint, method = 'GET', data = null) {
                try {
                    const config = {
                        method,
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('latanda_auth_token')}`,
                            'Content-Type': 'application/json',
                            'X-User-ID': this.user.id,
                            'X-App-Version': '1.0.0'
                        }
                    };
                    
                    if (data && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {
                        config.body = JSON.stringify(data);
                    }
                    
                    const response = await fetch(`${this.apiBase}${endpoint}`, config);
                    
                    if (response.status === 401) {
                        // Token expired, redirect to login
                        localStorage.removeItem('latanda_auth_token');
                        localStorage.removeItem('latanda_user');
                        window.location.href = 'auth-enhanced.html';
                        return { success: false, error: 'Unauthorized' };
                    }
                    
                    const result = await response.json();
                    
                    return {
                        success: response.ok,
                        data: result.data || result,
                        error: result.error || (!response.ok ? 'Request failed' : null),
                        status: response.status
                    };
                    
                } catch (error) {
                    return {
                        success: false,
                        error: error.message,
                        status: 0
                    };
                }
            }

            async syncDataToServer() {
                try {
                    const isDemoMode = localStorage.getItem('latanda_demo_mode') === 'true';
                    if (isDemoMode) return;
                    
                    // Sync user data
                    await this.apiRequest(`/api/users/${this.user.id}`, 'PUT', {
                        user: this.user,
                        stats: this.stats,
                        lastUpdated: new Date().toISOString()
                    });
                    
                    // Sync tandas data
                    await this.apiRequest(`/api/users/${this.user.id}/tandas`, 'PUT', {
                        tandas: this.tandas,
                        lastUpdated: new Date().toISOString()
                    });
                    
                    // Sync transactions
                    await this.apiRequest(`/api/users/${this.user.id}/transactions`, 'PUT', {
                        transactions: this.transactions.slice(0, 50), // Sync last 50 transactions
                        lastUpdated: new Date().toISOString()
                    });
                    
                    console.log('✅ Data successfully synced to server');
                    
                } catch (error) {
                    console.log('⚠️ Failed to sync data to server:', error.message);
                }
            }

            updateDashboardStats() {
                // Update the dashboard stats cards with real data
                const balanceEl = document.getElementById('walletBalance');
                const tandasEl = document.getElementById('activeGroups');
                const kycEl = document.getElementById('kycStatus');
                const ltdEl = document.getElementById('rewardPoints');

                if (balanceEl) balanceEl.textContent = `$${this.user.balance.toFixed(2)}`;
                if (tandasEl) tandasEl.textContent = this.stats.activeTandas;
                if (kycEl) kycEl.textContent = this.user.kycStatus === 'verified' ? '✅ Admin' : '⏳ Pendiente';
                if (ltdEl) ltdEl.textContent = this.user.ltdTokens.toLocaleString();
            }

            // Save data after any changes
            saveData() {
                try {
                    // Save to localStorage
                    localStorage.setItem('latanda_user', JSON.stringify(this.user));
                    localStorage.setItem('latanda_stats', JSON.stringify(this.stats));
                    localStorage.setItem('latanda_tandas', JSON.stringify(this.tandas));
                    localStorage.setItem('latanda_transactions', JSON.stringify(this.transactions));
                    
                    // Save LTD data if it exists
                    if (this.ltdData) {
                        localStorage.setItem('latanda_ltd_data', JSON.stringify(this.ltdData));
                    }
                    
                    // Save timestamp of last local update
                    localStorage.setItem('latanda_last_local_update', new Date().toISOString());
                    
                    // Update dashboard display
                    this.updateDashboardStats();
                    this.updateUserDropdown();
                    
                    // Async sync to server (non-blocking)
                    setTimeout(() => {
                        this.syncDataToServer();
                    }, 100);
                    
                    console.log('💾 Data saved locally and queued for server sync');
                    
                } catch (error) {
                    console.error('❌ Error saving data:', error);
                    this.showNotification('⚠️ Error', 'Error guardando datos localmente');
                }
            }

            // Enhanced data validation and backup
            validateAndBackupData() {
                try {
                    // Validate user data structure
                    if (!this.user || !this.user.id || !this.user.name) {
                        throw new Error('Invalid user data structure');
                    }
                    
                    // Validate stats data
                    if (!this.stats || typeof this.stats.balance !== 'number') {
                        throw new Error('Invalid stats data structure');
                    }
                    
                    // Create backup
                    const backupData = {
                        user: this.user,
                        stats: this.stats,
                        tandas: this.tandas,
                        transactions: this.transactions.slice(0, 100), // Keep last 100
                        timestamp: new Date().toISOString(),
                        version: '1.0.0'
                    };
                    
                    localStorage.setItem('latanda_data_backup', JSON.stringify(backupData));
                    console.log('💾 Data validation passed, backup created');
                    
                    return true;
                    
                } catch (error) {
                    console.error('❌ Data validation failed:', error);
                    this.restoreFromBackup();
                    return false;
                }
            }

            restoreFromBackup() {
                try {
                    const backup = localStorage.getItem('latanda_data_backup');
                    if (backup) {
                        const backupData = JSON.parse(backup);
                        
                        this.user = backupData.user;
                        this.stats = backupData.stats;
                        this.tandas = backupData.tandas || [];
                        this.transactions = backupData.transactions || [];
                        
                        this.showNotification('🔄 Datos Restaurados', 'Datos restaurados desde backup');
                        console.log('✅ Data restored from backup');
                    }
                } catch (error) {
                    console.error('❌ Failed to restore from backup:', error);
                    this.initializeDefaultData();
                }
            }

            initializeDefaultData() {
                console.log('🎆 Initializing default data for new user');
                
                this.user = {
                    id: `user_${Date.now()}`,
                    name: 'Usuario Demo',
                    role: 'demo',
                    email: 'demo@latanda.com',
                    avatar: 'D',
                    balance: 1000.00,
                    ltdTokens: 100,
                    joinDate: new Date().toISOString().split('T')[0],
                    walletAddress: '0x' + Math.random().toString(16).substr(2, 8) + '...' + Math.random().toString(16).substr(2, 4),
                    phone: '+504 0000-0000',
                    kycStatus: 'pending',
                    kycLevel: 'basic'
                };
                
                this.stats = {
                    balance: this.user.balance,
                    activeTandas: 0,
                    completedTandas: 0,
                    totalEarnings: 0,
                    kycStatus: 'pending',
                    ltdTokens: this.user.ltdTokens,
                    stakingRewards: 0,
                    lastUpdated: new Date().toISOString()
                };
                
                this.tandas = [];
                this.transactions = [];
                
                this.saveData();
                this.showNotification('🎆 Bienvenido', 'Cuenta demo inicializada correctamente');
            }

            // Original loadUserData function (simulated for demo)
            loadUserDataOLD() {
                const savedStats = localStorage.getItem('latanda_stats');
                if (savedStats) {
                    this.stats = { ...this.stats, ...JSON.parse(savedStats) };
                }
            }

            updateWelcomeMessage() {
                if (this.user) {
                    const welcomeTitle = document.getElementById('welcomeTitle');
                    const welcomeSubtitle = document.getElementById('welcomeSubtitle');
                    
                    if (welcomeTitle) {
                        welcomeTitle.textContent = `¡Bienvenido, ${this.user.name}!`;
                    }
                    
                    if (welcomeSubtitle) {
                        const timeOfDay = new Date().getHours();
                        let greeting = 'Buenos días';
                        if (timeOfDay >= 12 && timeOfDay < 18) greeting = 'Buenas tardes';
                        else if (timeOfDay >= 18) greeting = 'Buenas noches';
                        
                        welcomeSubtitle.textContent = `${greeting}, listo para gestionar tus finanzas`;
                    }
                }
            }

            updateUserProfile() {
                if (this.user) {
                    const userAvatar = document.getElementById('userAvatar');
                    const userName = document.getElementById('userName');
                    const userRole = document.getElementById('userRole');
                    
                    if (userAvatar) {
                        userAvatar.textContent = this.user.name.charAt(0).toUpperCase();
                    }
                    
                    if (userName) {
                        userName.textContent = this.user.name;
                    }
                    
                    if (userRole) {
                        userRole.textContent = this.user.role === 'admin' ? 'Administrador Sistema' :
                                              this.user.role === 'demo' ? 'Usuario Demo' : 
                                              this.user.role === 'tester' ? 'Usuario Test' : 'Miembro';
                    }
                }
            }

            updateUI() {
                // Update stats display
                const balanceEl = document.getElementById('walletBalance');
                const groupsEl = document.getElementById('activeGroups');
                const kycEl = document.getElementById('kycStatus');
                const pointsEl = document.getElementById('rewardPoints');

                if (balanceEl) balanceEl.textContent = `$${this.stats.balance.toFixed(2)}`;
                if (groupsEl) groupsEl.textContent = this.stats.groups.toString();
                if (kycEl) kycEl.textContent = this.stats.kyc;
                if (pointsEl) pointsEl.textContent = this.stats.points.toString();
                
                // Update user dropdown
                this.updateUserDropdown();
            }

            simulateDataUpdates() {
                // Add some demo activity over time (only a few updates, then stop)
                let updateCount = 0;
                const maxUpdates = 3;
                
                const scheduleUpdate = (delay, updateFn) => {
                    setTimeout(() => {
                        if (updateCount < maxUpdates) {
                            updateFn();
                            updateCount++;
                        }
                    }, delay);
                };
                
                // Schedule limited updates
                scheduleUpdate(3000, () => {
                    this.stats.points += 25;
                    this.updateUI();
                    this.addActivity('🎁', 'Bonus diario recibido', '25 puntos LTD otorgados', 'Hace 30s');
                });

                scheduleUpdate(8000, () => {
                    this.stats.balance += 10.50;
                    this.updateUI();
                    this.addActivity('💰', 'Depósito procesado', '$10.50 añadidos a tu wallet', 'Hace 1m');
                });
                
                scheduleUpdate(15000, () => {
                    this.stats.groups += 1;
                    this.updateUI();
                    this.addActivity('👥', 'Nueva tanda disponible', 'Invitación a grupo "Ahorro Familiar"', 'Hace 5m');
                });
            }

            addActivity(icon, title, description, time) {
                const activityList = document.querySelector('.activity-list');
                if (activityList) {
                    const newActivity = document.createElement('div');
                    newActivity.className = 'activity-item';
                    newActivity.innerHTML = `
                        <div class="activity-icon success">${icon}</div>
                        <div class="activity-content">
                            <div class="activity-title">${title}</div>
                            <div class="activity-description">${description}</div>
                        </div>
                        <div class="activity-time">${time}</div>
                    `;
                    
                    // Insert at the beginning
                    activityList.insertBefore(newActivity, activityList.firstChild);
                    
                    // Remove last item if more than 5
                    const activities = activityList.querySelectorAll('.activity-item');
                    if (activities.length > 5) {
                        activityList.removeChild(activities[activities.length - 1]);
                    }
                }
            }

            setupEventListeners() {
                // Listen for navigation events
                window.addEventListener('message', (event) => {
                    if (event.data.type === 'latanda:navigate') {
                        this.navigateToSection(event.data.section);
                    }
                });
            }

            navigateToSection(section) {
                // Check if we're in iframe (inside la-tanda-complete.html)
                if (window.parent !== window) {
                    // Send navigation message to parent
                    window.parent.postMessage({
                        type: 'latanda:navigate',
                        section: section
                    }, '*');
                } else {
                    // Direct navigation to specific pages
                    this.handleDirectNavigation(section);
                }
            }

            handleDirectNavigation(section) {
                const sectionPages = {
                    'home': 'home-dashboard.html',
                    'wallet': 'tanda-wallet.html',
                    'kyc': 'kyc-registration.html',
                    'groups': 'groups-advanced-system.html',
                    'create-group': 'groups-advanced-system.html',
                    'invitations': 'groups-advanced-system.html',
                    'transactions': 'web3-dashboard.html',
                    'trading': 'web3-dashboard.html',
                    'staking': 'web3-dashboard.html',
                    'dashboard': 'web3-dashboard.html',
                    'nft': 'marketplace-social.html',
                    'marketplace': 'marketplace-social.html',
                    'dao': 'web3-dashboard.html',
                    'tokenomics': 'ltd-token-economics.html',
                    'security': 'admin-system-demo.html',
                    'profile': 'home-dashboard.html',
                    'settings': 'home-dashboard.html'
                };

                const targetPage = sectionPages[section];
                if (targetPage) {
                    // Store current user session to maintain login
                    const currentUser = localStorage.getItem('latanda_user');
                    const currentToken = localStorage.getItem('latanda_auth_token');
                    
                    if (currentUser && currentToken) {
                        // Navigate to specific page
                        window.location.href = targetPage;
                    } else {
                        // User not authenticated, redirect to login
                        window.location.href = 'auth-enhanced.html';
                    }
                } else {
                    // Fallback to complete page
                    window.location.href = `/la-tanda-complete.html#${section}`;
                }
            }

            quickStart() {
                // Show quick start guide
                const steps = [
                    { section: 'kyc', title: '1. Completar KYC', description: 'Verifica tu identidad' },
                    { section: 'wallet', title: '2. Configurar Wallet', description: 'Conecta tu wallet Web3' },
                    { section: 'groups', title: '3. Unirse a Tandas', description: 'Participa en grupos de ahorro' }
                ];

                let currentStep = 0;
                const nextStep = () => {
                    if (currentStep < steps.length) {
                        const step = steps[currentStep];
                        this.showNotification(step.title, step.description);
                        setTimeout(() => {
                            this.navigateToSection(step.section);
                        }, 2000);
                        currentStep++;
                    }
                };

                nextStep();
            }

            showDetailedModal(title, content, actions = []) {
                // Remove existing modal
                const existingModal = document.getElementById('detailModal');
                if (existingModal) {
                    existingModal.remove();
                }

                // Create modal
                const modal = document.createElement('div');
                modal.id = 'detailModal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                    backdrop-filter: blur(10px);
                `;

                const modalContent = document.createElement('div');
                modalContent.style.cssText = `
                    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                    border-radius: 16px;
                    padding: 24px;
                    max-width: 600px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                    border: 1px solid rgba(0, 255, 255, 0.2);
                    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
                `;

                const actionsHtml = actions.map((action, index) => 
                    `<button onclick="document.getElementById('detailModal').remove(); dashboard.${action.action.name || 'executeAction'}(${index})" 
                             style="background: linear-gradient(135deg, #00FFFF, #7FFFD8); color: #0f172a; border: none; padding: 8px 16px; border-radius: 8px; margin: 5px; cursor: pointer; font-weight: 600;">
                        ${action.text}
                     </button>`
                ).join('');

                modalContent.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="color: #00FFFF; margin: 0; font-size: 24px;">${title}</h2>
                        <button onclick="document.getElementById('detailModal').remove()" 
                                style="background: rgba(255,255,255,0.1); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 18px;">
                            ×
                        </button>
                    </div>
                    <pre style="color: #f8fafc; font-family: 'JetBrains Mono', monospace; font-size: 14px; line-height: 1.6; white-space: pre-wrap; margin-bottom: 20px;">${content}</pre>
                    <div style="text-align: center;">
                        ${actionsHtml}
                    </div>
                `;

                modal.appendChild(modalContent);
                document.body.appendChild(modal);

                // Store actions for execution
                this.modalActions = actions;

                // Close on background click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            }

            executeAction(index) {
                if (this.modalActions && this.modalActions[index]) {
                    this.modalActions[index].action();
                }
            }

            // Action functions for Balance Details
            generateBalanceReport() {
                this.showNotification('📊 Generando Reporte', 'Compilando datos de balance...');
                
                // Generate actual report data
                const reportData = {
                    userId: this.user.id,
                    userName: this.user.name,
                    generatedDate: new Date().toISOString(),
                    totalBalance: this.user.balance,
                    ltdTokens: this.user.ltdTokens,
                    activeTandas: this.stats.activeTandas,
                    monthlyIncome: this.calculateMonthlyIncome(),
                    transactions: this.transactions.slice(0, 10) // Last 10 transactions
                };
                
                // Save report to localStorage and simulate download
                localStorage.setItem('latanda_last_report', JSON.stringify(reportData));
                
                setTimeout(() => {
                    const blob = new Blob([JSON.stringify(reportData, null, 2)], {type: 'application/json'});
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `balance_report_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('✅ Reporte Descargado', 'Reporte guardado exitosamente');
                }, 2000);
            }

            showWithdrawModal() {
                // Create withdrawal modal
                const modal = document.createElement('div');
                modal.id = 'withdrawModal';
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0, 0, 0, 0.8); display: flex; align-items: center;
                    justify-content: center; z-index: 1000; backdrop-filter: blur(10px);
                `;
                
                modal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                                border-radius: 16px; padding: 24px; max-width: 400px; width: 90%;
                                border: 1px solid rgba(0, 255, 255, 0.2);">
                        <h3 style="color: #00FFFF; margin-bottom: 20px;">💳 Retirar Fondos</h3>
                        <div style="margin-bottom: 15px;">
                            <label style="color: #f8fafc; display: block; margin-bottom: 5px;">Cantidad a retirar:</label>
                            <input type="number" id="withdrawAmount" placeholder="0.00" max="${this.user.balance}" 
                                   style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #374151;
                                          background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                            <small style="color: #9ca3af;">Disponible: L. ${this.user.balance.toFixed(2)}</small>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="color: #f8fafc; display: block; margin-bottom: 5px;">Método de retiro:</label>
                            <select id="withdrawMethod" style="width: 100%; padding: 12px; border-radius: 8px;
                                                              border: 1px solid #374151; background: rgba(0,0,0,0.3);
                                                              color: white; font-size: 14px;">
                                <option value="bank">🏦 Transferencia Bancaria</option>
                                <option value="mobile">📱 Tigo Money / Claro</option>
                                <option value="crypto">₿ Criptomoneda</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button onclick="document.getElementById('withdrawModal').remove()"
                                    style="padding: 8px 16px; border: 1px solid #374151; background: transparent;
                                           color: white; border-radius: 8px; cursor: pointer;">Cancelar</button>
                            <button onclick="dashboard.processWithdrawal()"
                                    style="padding: 8px 16px; background: linear-gradient(135deg, #00FFFF, #7FFFD8);
                                           color: #0f172a; border: none; border-radius: 8px; cursor: pointer;
                                           font-weight: 600;">Procesar Retiro</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }

            processWithdrawal() {
                const amount = parseFloat(document.getElementById('withdrawAmount').value);
                const method = document.getElementById('withdrawMethod').value;
                
                if (!amount || amount <= 0) {
                    this.showNotification('❌ Error', 'Ingresa una cantidad válida');
                    return;
                }
                
                if (amount > this.user.balance) {
                    this.showNotification('❌ Error', 'Fondos insuficientes');
                    return;
                }
                
                // Process withdrawal
                this.user.balance -= amount;
                this.stats.balance = this.user.balance;
                
                // Add transaction
                this.transactions.unshift({
                    id: `tx_${Date.now()}`,
                    type: 'withdrawal',
                    amount: -amount,
                    description: `Retiro via ${method}`,
                    date: new Date().toISOString(),
                    status: 'completed'
                });
                
                this.saveData();
                this.updateDashboardStats();
                
                document.getElementById('withdrawModal').remove();
                this.showNotification('✅ Retiro Procesado', `L. ${amount.toFixed(2)} retirado exitosamente`);
                this.addActivity('💸', 'Retiro procesado', `L. ${amount.toFixed(2)} retirado`, 'now');
            }

            calculateMonthlyIncome() {
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                return this.transactions
                    .filter(tx => {
                        const txDate = new Date(tx.date);
                        return txDate.getMonth() === currentMonth && 
                               txDate.getFullYear() === currentYear &&
                               tx.amount > 0;
                    })
                    .reduce((sum, tx) => sum + tx.amount, 0);
            }

            // Action functions for Tandas Details
            showPerformanceAnalysis() {
                const analysisData = this.calculateTandaPerformance();
                
                const analysisContent = `
📈 ANÁLISIS DE RENDIMIENTO - TANDAS

┌─ RESUMEN GENERAL ──────────────────┐
│ 🎯 Tandas Activas: ${this.stats.activeTandas}           │
│ ✅ Tandas Completadas: ${this.stats.completedTandas}         │
│ 💰 Total Invertido: L. ${analysisData.totalInvested.toFixed(2)}   │
│ 📊 ROI Promedio: ${analysisData.averageROI}%            │
└────────────────────────────────────┘

┌─ RENDIMIENTO POR TANDA ────────────┐
${this.tandas.map(tanda => `│ ${tanda.name}: ${tanda.status === 'active' ? '🟢' : '🔵'} ${((tanda.collectedAmount / tanda.totalAmount) * 100).toFixed(1)}%`).join('\n')}
└────────────────────────────────────┘

┌─ MÉTRICAS DE PARTICIPACIÓN ───────┐
│ 📅 Pagos a tiempo: ${analysisData.onTimePayments}%         │
│ ⭐ Rating promedio: ${analysisData.averageRating}/5       │
│ 🏆 Posición ranking: Top ${analysisData.rankPosition}%        │
│ 💎 Confiabilidad: ${analysisData.trustScore}%           │
└────────────────────────────────────┘
                `;
                
                this.showDetailedModal('📈 Análisis de Rendimiento', analysisContent, [
                    { text: '📊 Ver Dashboard Completo', action: () => this.navigateToSection('dashboard') },
                    { text: '📈 Exportar Análisis', action: () => this.exportPerformanceData(analysisData) },
                    { text: '🎯 Optimizar Portfolio', action: () => this.showOptimizationSuggestions() }
                ]);
            }

            calculateTandaPerformance() {
                const totalInvested = this.tandas.reduce((sum, tanda) => sum + (tanda.monthlyAmount * (tanda.maxParticipants - tanda.remainingPayments)), 0);
                const totalReturns = this.tandas.reduce((sum, tanda) => sum + tanda.collectedAmount, 0);
                
                return {
                    totalInvested,
                    totalReturns,
                    averageROI: totalInvested > 0 ? ((totalReturns - totalInvested) / totalInvested * 100).toFixed(1) : 0,
                    onTimePayments: 98.5,
                    averageRating: 4.8,
                    rankPosition: 5,
                    trustScore: 96
                };
            }

            exportPerformanceData(data) {
                const exportData = {
                    ...data,
                    tandas: this.tandas,
                    exportDate: new Date().toISOString(),
                    userId: this.user.id
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tanda_performance_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showNotification('📊 Datos Exportados', 'Análisis guardado exitosamente');
            }

            showOptimizationSuggestions() {
                const suggestions = `
🎯 SUGERENCIAS DE OPTIMIZACIÓN

┌─ RECOMENDACIONES INMEDIATAS ──────┐
│ 💡 Diversifica en 2 tandas más      │
│ 📈 Aumenta contribución mensual 15% │
│ 🎪 Considera tandas empresariales   │
│ ⏰ Optimiza timing de pagos         │
└────────────────────────────────────┘

┌─ OPORTUNIDADES DE CRECIMIENTO ────┐
│ 🚀 Potencial ganancia extra: +23%  │
│ 👥 Refiere amigos: bonus 50 LTD    │
│ 🏆 Meta coordinator: +500 LTD      │
│ 💎 Premium benefits disponibles    │
└────────────────────────────────────┘
                `;
                
                this.showDetailedModal('🎯 Optimización de Portfolio', suggestions, [
                    { text: '🚀 Aplicar Sugerencias', action: () => this.applyOptimizations() },
                    { text: '👥 Buscar Tandas', action: () => this.navigateToSection('groups') }
                ]);
            }

            applyOptimizations() {
                this.showNotification('🚀 Optimizando', 'Aplicando sugerencias de mejora...');
                setTimeout(() => {
                    this.user.ltdTokens += 25; // Optimization bonus
                    this.saveData();
                    this.showNotification('✅ Portfolio Optimizado', '+25 LTD bonus por optimización!');
                }, 2000);
            }

            managePaymentAlerts() {
                const alertModal = document.createElement('div');
                alertModal.id = 'alertModal';
                alertModal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0, 0, 0, 0.8); display: flex; align-items: center;
                    justify-content: center; z-index: 1000; backdrop-filter: blur(10px);
                `;
                
                alertModal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                                border-radius: 16px; padding: 24px; max-width: 500px; width: 90%;
                                border: 1px solid rgba(0, 255, 255, 0.2);">
                        <h3 style="color: #00FFFF; margin-bottom: 20px;">⚠️ Configurar Alertas de Pago</h3>
                        <div style="margin-bottom: 15px;">
                            <label style="color: #f8fafc; display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" checked style="margin-right: 10px;"> 
                                📱 Notificaciones SMS
                            </label>
                            <label style="color: #f8fafc; display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" checked style="margin-right: 10px;"> 
                                📧 Notificaciones Email
                            </label>
                            <label style="color: #f8fafc; display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" checked style="margin-right: 10px;"> 
                                🔔 Notificaciones Web
                            </label>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="color: #f8fafc; display: block; margin-bottom: 5px;">Recordar pago:</label>
                            <select style="width: 100%; padding: 12px; border-radius: 8px;
                                           border: 1px solid #374151; background: rgba(0,0,0,0.3);
                                           color: white; font-size: 14px;">
                                <option value="1">1 día antes</option>
                                <option value="3" selected>3 días antes</option>
                                <option value="7">1 semana antes</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button onclick="document.getElementById('alertModal').remove()"
                                    style="padding: 8px 16px; border: 1px solid #374151; background: transparent;
                                           color: white; border-radius: 8px; cursor: pointer;">Cancelar</button>
                            <button onclick="dashboard.savePaymentAlerts()"
                                    style="padding: 8px 16px; background: linear-gradient(135deg, #00FFFF, #7FFFD8);
                                           color: #0f172a; border: none; border-radius: 8px; cursor: pointer;
                                           font-weight: 600;">Guardar Alertas</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(alertModal);
            }

            savePaymentAlerts() {
                localStorage.setItem('latanda_payment_alerts', JSON.stringify({
                    sms: true,
                    email: true,
                    web: true,
                    reminderDays: 3,
                    savedAt: new Date().toISOString()
                }));
                
                document.getElementById('alertModal').remove();
                this.showNotification('✅ Alertas Configuradas', 'Notificaciones de pago activadas');
            }

            // Action functions for KYC Details
            downloadKYCCertificate() {
                this.showNotification('📄 Generando Certificado', 'Creando certificado KYC personalizado...');
                
                // Generate KYC certificate data
                const certificateData = {
                    userId: this.user.id,
                    userName: this.user.name,
                    verificationLevel: this.user.kycLevel || 'verified',
                    issueDate: new Date().toISOString(),
                    expiryDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(), // 1 year
                    certificateId: `KYC-${Date.now()}`,
                    verifiedDocuments: ['ID', 'Address', 'Income'],
                    riskLevel: 'Low',
                    complianceScore: 98
                };
                
                // Create certificate content
                const certificateContent = `
===========================================
          CERTIFICADO KYC - LA TANDA
===========================================

ID Certificado: ${certificateData.certificateId}
Fecha Emisión: ${new Date(certificateData.issueDate).toLocaleDateString()}
Fecha Vencimiento: ${new Date(certificateData.expiryDate).toLocaleDateString()}

-------------------------------------------
DATOS DEL USUARIO:
-------------------------------------------
Nombre: ${certificateData.userName}
ID Usuario: ${certificateData.userId}
Nivel Verificación: ${certificateData.verificationLevel.toUpperCase()}
Puntuación Compliance: ${certificateData.complianceScore}%
Nivel de Riesgo: ${certificateData.riskLevel}

-------------------------------------------
DOCUMENTOS VERIFICADOS:
-------------------------------------------
${certificateData.verifiedDocuments.map(doc => `✓ ${doc}`).join('\n')}

-------------------------------------------
Este certificado confirma que el usuario ha
completado exitosamente el proceso de
verificación KYC/AML de La Tanda.

Emitido por: Sistema La Tanda
Válido hasta: ${new Date(certificateData.expiryDate).toLocaleDateString()}
===========================================
                `;
                
                setTimeout(() => {
                    // Save certificate data
                    localStorage.setItem('latanda_kyc_certificate', JSON.stringify(certificateData));
                    
                    // Create downloadable file
                    const blob = new Blob([certificateContent], {type: 'text/plain'});
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Certificado_KYC_${this.user.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('✅ Certificado Descargado', 'Certificado KYC guardado exitosamente');
                    this.addActivity('📄', 'Certificado KYC', 'Certificado descargado', 'now');
                }, 2000);
            }

            renewKYCVerification() {
                const renewalModal = document.createElement('div');
                renewalModal.id = 'renewalModal';
                renewalModal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0, 0, 0, 0.8); display: flex; align-items: center;
                    justify-content: center; z-index: 1000; backdrop-filter: blur(10px);
                `;
                
                renewalModal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                                border-radius: 16px; padding: 24px; max-width: 450px; width: 90%;
                                border: 1px solid rgba(0, 255, 255, 0.2);">
                        <h3 style="color: #00FFFF; margin-bottom: 20px;">🔄 Renovar Verificación KYC</h3>
                        <p style="color: #f8fafc; margin-bottom: 20px;">Renueva tu verificación KYC para mantener acceso completo a todas las funciones.</p>
                        
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <p style="color: #22d55e; margin-bottom: 10px;">✓ Verificación actual: Válida</p>
                            <p style="color: #f8fafc; font-size: 14px; margin-bottom: 5px;">Vencimiento: ${new Date(Date.now() + 180 * 24 * 60 * 60 * 1000).toLocaleDateString()}</p>
                            <p style="color: #9ca3af; font-size: 12px;">Renueva ahora para extender por 1 año más</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="color: #f8fafc; display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="confirmData" style="margin-right: 10px;"> 
                                Confirmo que mis datos personales están actualizados
                            </label>
                            <label style="color: #f8fafc; display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="confirmAddress" style="margin-right: 10px;"> 
                                Confirmo que mi dirección es actual
                            </label>
                            <label style="color: #f8fafc; display: flex; align-items: center;">
                                <input type="checkbox" id="confirmIncome" style="margin-right: 10px;"> 
                                Confirmo que mi información financiera es correcta
                            </label>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button onclick="document.getElementById('renewalModal').remove()"
                                    style="padding: 8px 16px; border: 1px solid #374151; background: transparent;
                                           color: white; border-radius: 8px; cursor: pointer;">Cancelar</button>
                            <button onclick="dashboard.processKYCRenewal()"
                                    style="padding: 8px 16px; background: linear-gradient(135deg, #00FFFF, #7FFFD8);
                                           color: #0f172a; border: none; border-radius: 8px; cursor: pointer;
                                           font-weight: 600;">Renovar KYC</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(renewalModal);
            }

            processKYCRenewal() {
                const confirmData = document.getElementById('confirmData').checked;
                const confirmAddress = document.getElementById('confirmAddress').checked;
                const confirmIncome = document.getElementById('confirmIncome').checked;
                
                if (!confirmData || !confirmAddress || !confirmIncome) {
                    this.showNotification('❌ Error', 'Debes confirmar todos los campos');
                    return;
                }
                
                this.showNotification('🔄 Procesando', 'Renovando verificación KYC...');
                
                setTimeout(() => {
                    // Update KYC data
                    this.user.kycRenewalDate = new Date().toISOString();
                    this.user.kycExpiryDate = new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString();
                    
                    // Add LTD bonus for renewal
                    this.user.ltdTokens += 15;
                    
                    this.saveData();
                    document.getElementById('renewalModal').remove();
                    
                    this.showNotification('✅ KYC Renovado', 'Verificación extendida por 1 año. +15 LTD bonus!');
                    this.addActivity('🔄', 'KYC Renovado', 'Verificación actualizada +1 año', 'now');
                }, 2000);
            }

            configureKYCAlerts() {
                const alertsModal = document.createElement('div');
                alertsModal.id = 'kycAlertsModal';
                alertsModal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0, 0, 0, 0.8); display: flex; align-items: center;
                    justify-content: center; z-index: 1000; backdrop-filter: blur(10px);
                `;
                
                alertsModal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                                border-radius: 16px; padding: 24px; max-width: 500px; width: 90%;
                                border: 1px solid rgba(0, 255, 255, 0.2);">
                        <h3 style="color: #00FFFF; margin-bottom: 20px;">⚙️ Configurar Alertas KYC</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #f8fafc; margin-bottom: 15px;">Alertas de Vencimiento:</h4>
                            <label style="color: #f8fafc; display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" checked style="margin-right: 10px;"> 
                                ✉️ Email 30 días antes
                            </label>
                            <label style="color: #f8fafc; display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" checked style="margin-right: 10px;"> 
                                📱 SMS 15 días antes
                            </label>
                            <label style="color: #f8fafc; display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" checked style="margin-right: 10px;"> 
                                🔔 Notificación web 7 días antes
                            </label>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #f8fafc; margin-bottom: 15px;">Monitoreo de Compliance:</h4>
                            <label style="color: #f8fafc; display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" checked style="margin-right: 10px;"> 
                                📈 Reportes mensuales de actividad
                            </label>
                            <label style="color: #f8fafc; display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" style="margin-right: 10px;"> 
                                ⚠️ Alertas de transacciones sospechosas
                            </label>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button onclick="document.getElementById('kycAlertsModal').remove()"
                                    style="padding: 8px 16px; border: 1px solid #374151; background: transparent;
                                           color: white; border-radius: 8px; cursor: pointer;">Cancelar</button>
                            <button onclick="dashboard.saveKYCAlerts()"
                                    style="padding: 8px 16px; background: linear-gradient(135deg, #00FFFF, #7FFFD8);
                                           color: #0f172a; border: none; border-radius: 8px; cursor: pointer;
                                           font-weight: 600;">Guardar Configuración</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(alertsModal);
            }

            saveKYCAlerts() {
                const alertConfig = {
                    emailReminder: true,
                    smsReminder: true,
                    webNotification: true,
                    monthlyReports: true,
                    suspiciousAlerts: false,
                    configuredAt: new Date().toISOString()
                };
                
                localStorage.setItem('latanda_kyc_alerts', JSON.stringify(alertConfig));
                document.getElementById('kycAlertsModal').remove();
                
                this.showNotification('✅ Alertas Configuradas', 'Notificaciones KYC activadas correctamente');
                this.addActivity('⚙️', 'Alertas KYC', 'Configuración actualizada', 'now');
            }

            // Action functions for LTD Details
            openStakingModal() {
                const stakingModal = document.createElement('div');
                stakingModal.id = 'stakingModal';
                stakingModal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0, 0, 0, 0.8); display: flex; align-items: center;
                    justify-content: center; z-index: 1000; backdrop-filter: blur(10px);
                `;
                
                const availableLTD = this.user.ltdTokens - (this.user.stakedLTD || 0);
                
                stakingModal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                                border-radius: 16px; padding: 24px; max-width: 500px; width: 90%;
                                border: 1px solid rgba(0, 255, 255, 0.2);">
                        <h3 style="color: #00FFFF; margin-bottom: 20px;">🔄 Staking LTD</h3>
                        
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #f8fafc;">Disponible para staking:</span>
                                <span style="color: #22d55e; font-weight: 600;">${availableLTD} LTD</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #f8fafc;">Ya en staking:</span>
                                <span style="color: #fbbf24; font-weight: 600;">${this.user.stakedLTD || 0} LTD</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #f8fafc;">APY Actual:</span>
                                <span style="color: #00FFFF; font-weight: 600;">24.5%</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="color: #f8fafc; display: block; margin-bottom: 5px;">Cantidad a hacer staking:</label>
                            <input type="number" id="stakingAmount" placeholder="0" max="${availableLTD}" 
                                   style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #374151;
                                          background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                            <small style="color: #9ca3af;">Mínimo: 100 LTD | Máximo: ${availableLTD} LTD</small>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="color: #f8fafc; display: block; margin-bottom: 5px;">Período de bloqueo:</label>
                            <select id="stakingPeriod" style="width: 100%; padding: 12px; border-radius: 8px;
                                                           border: 1px solid #374151; background: rgba(0,0,0,0.3);
                                                           color: white; font-size: 14px;">
                                <option value="30">30 días - APY 18%</option>
                                <option value="90" selected>90 días - APY 24.5%</option>
                                <option value="180">180 días - APY 32%</option>
                                <option value="365">365 días - APY 45%</option>
                            </select>
                        </div>
                        
                        <div style="background: rgba(0, 255, 255, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;
                                    border: 1px solid rgba(0, 255, 255, 0.2);">
                            <div style="color: #00FFFF; font-weight: 600; margin-bottom: 5px;">Ganancias Estimadas:</div>
                            <div style="color: #f8fafc; font-size: 14px;" id="estimatedRewards">Ingresa cantidad para calcular</div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button onclick="document.getElementById('stakingModal').remove()"
                                    style="padding: 8px 16px; border: 1px solid #374151; background: transparent;
                                           color: white; border-radius: 8px; cursor: pointer;">Cancelar</button>
                            <button onclick="dashboard.processStaking()"
                                    style="padding: 8px 16px; background: linear-gradient(135deg, #00FFFF, #7FFFD8);
                                           color: #0f172a; border: none; border-radius: 8px; cursor: pointer;
                                           font-weight: 600;">Iniciar Staking</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(stakingModal);
                
                // Add real-time calculation
                const amountInput = document.getElementById('stakingAmount');
                const periodSelect = document.getElementById('stakingPeriod');
                const rewardsDiv = document.getElementById('estimatedRewards');
                
                const calculateRewards = () => {
                    const amount = parseFloat(amountInput.value) || 0;
                    const days = parseInt(periodSelect.value);
                    const apy = days === 30 ? 18 : days === 90 ? 24.5 : days === 180 ? 32 : 45;
                    const rewards = (amount * apy / 100 * days / 365);
                    
                    if (amount > 0) {
                        rewardsDiv.innerHTML = `
                            <div>Ganancias en ${days} días: <strong>${rewards.toFixed(2)} LTD</strong></div>
                            <div>Ganancia diaria: <strong>${(rewards / days).toFixed(3)} LTD</strong></div>
                        `;
                    } else {
                        rewardsDiv.textContent = 'Ingresa cantidad para calcular';
                    }
                };
                
                amountInput.addEventListener('input', calculateRewards);
                periodSelect.addEventListener('change', calculateRewards);
            }

            processStaking() {
                const amount = parseFloat(document.getElementById('stakingAmount').value);
                const period = parseInt(document.getElementById('stakingPeriod').value);
                
                if (!amount || amount < 100) {
                    this.showNotification('❌ Error', 'La cantidad mínima es 100 LTD');
                    return;
                }
                
                const availableLTD = this.user.ltdTokens - (this.user.stakedLTD || 0);
                if (amount > availableLTD) {
                    this.showNotification('❌ Error', 'No tienes suficientes LTD disponibles');
                    return;
                }
                
                this.showNotification('🔄 Procesando Staking', 'Bloqueando tokens en el contrato...');
                
                setTimeout(() => {
                    // Update staking data
                    if (!this.user.stakedLTD) this.user.stakedLTD = 0;
                    this.user.stakedLTD += amount;
                    
                    // Add staking record
                    if (!this.user.stakingRecords) this.user.stakingRecords = [];
                    this.user.stakingRecords.push({
                        amount: amount,
                        period: period,
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + period * 24 * 60 * 60 * 1000).toISOString(),
                        apy: period === 30 ? 18 : period === 90 ? 24.5 : period === 180 ? 32 : 45,
                        id: `stake_${Date.now()}`
                    });
                    
                    this.saveData();
                    document.getElementById('stakingModal').remove();
                    
                    this.showNotification('✅ Staking Exitoso', `${amount} LTD bloqueados por ${period} días`);
                    this.addActivity('🔄', 'Staking Iniciado', `${amount} LTD x ${period} días`, 'now');
                }, 2000);
            }

            openExchangeModal() {
                const exchangeModal = document.createElement('div');
                exchangeModal.id = 'exchangeModal';
                exchangeModal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0, 0, 0, 0.8); display: flex; align-items: center;
                    justify-content: center; z-index: 1000; backdrop-filter: blur(10px);
                `;
                
                exchangeModal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                                border-radius: 16px; padding: 24px; max-width: 500px; width: 90%;
                                border: 1px solid rgba(0, 255, 255, 0.2);">
                        <h3 style="color: #00FFFF; margin-bottom: 20px;">💱 Exchange LTD</h3>
                        
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="text-align: center;">
                                <div style="color: #00FFFF; font-size: 24px; font-weight: 600; margin-bottom: 5px;">$0.75</div>
                                <div style="color: #22d55e; font-size: 14px;">+$0.04 (5.2%) ↗️</div>
                                <div style="color: #9ca3af; font-size: 12px;">Precio actual LTD/USD</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                            <button id="buyTab" onclick="dashboard.switchExchangeTab('buy')" 
                                    style="flex: 1; padding: 12px; background: linear-gradient(135deg, #22d55e, #16a34a);
                                           color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Comprar LTD</button>
                            <button id="sellTab" onclick="dashboard.switchExchangeTab('sell')"
                                    style="flex: 1; padding: 12px; background: rgba(239, 68, 68, 0.2);
                                           color: #ef4444; border: 1px solid #ef4444; border-radius: 8px; font-weight: 600; cursor: pointer;">Vender LTD</button>
                        </div>
                        
                        <div id="exchangeForm">
                            <div style="margin-bottom: 15px;">
                                <label style="color: #f8fafc; display: block; margin-bottom: 5px;">Cantidad USD:</label>
                                <input type="number" id="usdAmount" placeholder="0.00" 
                                       style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #374151;
                                              background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="color: #f8fafc; display: block; margin-bottom: 5px;">Recibirás:</label>
                                <input type="text" id="ltdAmount" readonly placeholder="0 LTD"
                                       style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #374151;
                                              background: rgba(0,0,0,0.2); color: #00FFFF; font-size: 16px;">
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button onclick="document.getElementById('exchangeModal').remove()"
                                    style="padding: 8px 16px; border: 1px solid #374151; background: transparent;
                                           color: white; border-radius: 8px; cursor: pointer;">Cancelar</button>
                            <button onclick="dashboard.processExchange()"
                                    style="padding: 8px 16px; background: linear-gradient(135deg, #00FFFF, #7FFFD8);
                                           color: #0f172a; border: none; border-radius: 8px; cursor: pointer;
                                           font-weight: 600;">Ejecutar Intercambio</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(exchangeModal);
                
                // Add real-time calculation
                const usdInput = document.getElementById('usdAmount');
                const ltdOutput = document.getElementById('ltdAmount');
                
                usdInput.addEventListener('input', () => {
                    const usdValue = parseFloat(usdInput.value) || 0;
                    const ltdValue = usdValue / 0.75; // Current LTD price
                    ltdOutput.value = ltdValue > 0 ? `${ltdValue.toFixed(2)} LTD` : '0 LTD';
                });
            }

            switchExchangeTab(tab) {
                const buyTab = document.getElementById('buyTab');
                const sellTab = document.getElementById('sellTab');
                
                if (tab === 'buy') {
                    buyTab.style.background = 'linear-gradient(135deg, #22d55e, #16a34a)';
                    buyTab.style.color = 'white';
                    sellTab.style.background = 'rgba(239, 68, 68, 0.2)';
                    sellTab.style.color = '#ef4444';
                } else {
                    sellTab.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                    sellTab.style.color = 'white';
                    buyTab.style.background = 'rgba(34, 197, 94, 0.2)';
                    buyTab.style.color = '#22d55e';
                }
            }

            processExchange() {
                const usdAmount = parseFloat(document.getElementById('usdAmount').value);
                
                if (!usdAmount || usdAmount <= 0) {
                    this.showNotification('❌ Error', 'Ingresa una cantidad válida');
                    return;
                }
                
                if (usdAmount > this.user.balance) {
                    this.showNotification('❌ Error', 'Balance insuficiente');
                    return;
                }
                
                this.showNotification('💱 Procesando', 'Ejecutando intercambio en la blockchain...');
                
                setTimeout(() => {
                    const ltdReceived = usdAmount / 0.75;
                    const fee = usdAmount * 0.005; // 0.5% fee
                    
                    // Update balances
                    this.user.balance -= (usdAmount + fee);
                    this.user.ltdTokens += ltdReceived;
                    
                    // Add transaction
                    this.transactions.unshift({
                        id: `exchange_${Date.now()}`,
                        type: 'exchange',
                        amount: -usdAmount,
                        ltdAmount: ltdReceived,
                        description: `Compra de ${ltdReceived.toFixed(2)} LTD`,
                        date: new Date().toISOString(),
                        status: 'completed'
                    });
                    
                    this.saveData();
                    this.updateDashboardStats();
                    
                    document.getElementById('exchangeModal').remove();
                    this.showNotification('✅ Intercambio Exitoso', `+${ltdReceived.toFixed(2)} LTD agregados`);
                    this.addActivity('💱', 'Exchange Completado', `+${ltdReceived.toFixed(2)} LTD`, 'now');
                }, 3000);
            }

            showPriceChart() {
                const chartModal = document.createElement('div');
                chartModal.id = 'chartModal';
                chartModal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0, 0, 0, 0.8); display: flex; align-items: center;
                    justify-content: center; z-index: 1000; backdrop-filter: blur(10px);
                `;
                
                // Generate mock chart data
                const chartData = this.generateMockChartData();
                
                chartModal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                                border-radius: 16px; padding: 24px; max-width: 700px; width: 90%;
                                border: 1px solid rgba(0, 255, 255, 0.2); max-height: 80vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="color: #00FFFF; margin: 0;">📊 Gráfico de Precio LTD</h3>
                            <button onclick="document.getElementById('chartModal').remove()"
                                    style="background: rgba(255,255,255,0.1); border: none; color: white;
                                           width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 18px;">×</button>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="color: #00FFFF; font-size: 32px; font-weight: 600;">$0.75</div>
                            <div style="color: #22d55e; font-size: 16px; margin-bottom: 10px;">+$0.04 (5.2%) ↗️</div>
                            <div style="color: #9ca3af; font-size: 14px;">24h Volume: $127,450 | Market Cap: $3.2M</div>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="color: #f8fafc; text-align: center; padding: 40px; font-size: 16px;">
                                📈 Gráfico interactivo de precio LTD/USD<br>
                                <small style="color: #9ca3af; font-size: 12px;">Actualización en tiempo real cada 5 segundos</small><br><br>
                                <div style="display: flex; justify-content: center; gap: 20px; margin-top: 15px;">
                                    <div style="text-align: center;">
                                        <div style="color: #22d55e; font-weight: 600;">Máximo 24h</div>
                                        <div style="color: #f8fafc;">$0.78</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: #ef4444; font-weight: 600;">Mínimo 24h</div>
                                        <div style="color: #f8fafc;">$0.71</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="color: #00FFFF; font-weight: 600;">Cambio 7d</div>
                                <div style="color: #22d55e;">+12.3%</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="color: #00FFFF; font-weight: 600;">Cambio 30d</div>
                                <div style="color: #22d55e;">+28.7%</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="color: #00FFFF; font-weight: 600;">All Time High</div>
                                <div style="color: #f8fafc;">$1.24</div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(chartModal);
            }

            generateMockChartData() {
                // Generate 24 hours of mock price data
                const data = [];
                let price = 0.71;
                
                for (let i = 0; i < 24; i++) {
                    price += (Math.random() - 0.5) * 0.02; // Random price movement
                    price = Math.max(0.70, Math.min(0.80, price)); // Keep within range
                    data.push({
                        time: new Date(Date.now() - (24 - i) * 60 * 60 * 1000),
                        price: parseFloat(price.toFixed(4))
                    });
                }
                
                return data;
            }

            claimRewards() {
                this.showNotification('🎁 Calculando Rewards', 'Verificando rewards disponibles...');
                
                setTimeout(() => {
                    // Calculate available rewards
                    const stakingRewards = this.calculateStakingRewards();
                    const participationRewards = 47; // Mock participation rewards
                    const totalRewards = stakingRewards + participationRewards;
                    
                    if (totalRewards > 0) {
                        this.user.ltdTokens += totalRewards;
                        
                        // Add transaction
                        this.transactions.unshift({
                            id: `rewards_${Date.now()}`,
                            type: 'rewards',
                            amount: totalRewards,
                            description: `Rewards reclamados (Staking: ${stakingRewards}, Participación: ${participationRewards})`,
                            date: new Date().toISOString(),
                            status: 'completed'
                        });
                        
                        this.saveData();
                        this.updateUserDropdown();
                        this.updateDashboardStats();
                        
                        this.showNotification('✅ Rewards Reclamados', `+${totalRewards.toFixed(2)} LTD agregados a tu balance!`);
                        this.addActivity('🎁', 'Rewards Reclamados', `+${totalRewards.toFixed(2)} LTD`, 'now');
                    } else {
                        this.showNotification('ℹ️ Sin Rewards', 'No tienes rewards disponibles en este momento');
                    }
                }, 2000);
            }

            calculateStakingRewards() {
                if (!this.user.stakingRecords) return 0;
                
                let totalRewards = 0;
                const now = new Date();
                
                this.user.stakingRecords.forEach(stake => {
                    const startDate = new Date(stake.startDate);
                    const daysPassed = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));
                    const dailyRate = stake.apy / 365 / 100;
                    const rewards = stake.amount * dailyRate * daysPassed;
                    
                    // Only add unclaimed rewards
                    if (!stake.lastClaimed || new Date(stake.lastClaimed) < startDate) {
                        totalRewards += rewards;
                        stake.lastClaimed = now.toISOString();
                    }
                });
                
                return Math.round(totalRewards * 100) / 100; // Round to 2 decimals
            }

            showNotification(title, message) {
                // Create notification element
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--bg-glass);
                    backdrop-filter: blur(24px);
                    border: 1px solid var(--tanda-cyan);
                    border-radius: 12px;
                    padding: 16px 20px;
                    color: var(--text-primary);
                    z-index: 1000;
                    max-width: 300px;
                    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
                `;
                
                notification.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: 4px;">${title}</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">${message}</div>
                `;
                
                document.body.appendChild(notification);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 3000);
            }

            showUserMenu() {
                toggleUserMenu();
            }

            updateUserDropdown() {
                if (this.user) {
                    // Update dropdown header info
                    const dropdownAvatar = document.getElementById('dropdownAvatar');
                    const dropdownName = document.getElementById('dropdownName');
                    const dropdownEmail = document.getElementById('dropdownEmail');
                    const dropdownRole = document.getElementById('dropdownRole');
                    
                    if (dropdownAvatar) {
                        dropdownAvatar.textContent = this.user.name.charAt(0).toUpperCase();
                    }
                    
                    if (dropdownName) {
                        dropdownName.textContent = this.user.name;
                    }
                    
                    if (dropdownEmail) {
                        dropdownEmail.textContent = this.user.email || 'demo@latanda.com';
                    }
                    
                    if (dropdownRole) {
                        const roleText = this.user.role === 'admin' ? 'Administrador Sistema' :
                                        this.user.role === 'demo' ? 'Usuario Demo' : 
                                        this.user.role === 'tester' ? 'Usuario Test' : 
                                        this.user.role === 'premium' ? 'Usuario Premium' : 'Miembro';
                        dropdownRole.textContent = roleText;
                    }
                }
                
                // Update dropdown stats
                const dropdownBalance = document.getElementById('dropdownBalance');
                const dropdownPoints = document.getElementById('dropdownPoints');
                
                if (dropdownBalance) {
                    dropdownBalance.textContent = `$${this.user.balance.toFixed(2)}`;
                }
                
                if (dropdownPoints) {
                    dropdownPoints.textContent = `${this.user.ltdTokens} LTD`;
                }
                
                // Update notifications status
                const notificationsEnabled = localStorage.getItem('latanda_notifications_enabled') === 'true';
                const notificationsIcon = document.getElementById('notificationsIcon');
                const notificationsLabel = document.getElementById('notificationsLabel');
                
                if (notificationsIcon && notificationsLabel) {
                    if (notificationsEnabled) {
                        notificationsIcon.textContent = '🔔';
                        notificationsLabel.textContent = 'Notificaciones (ON)';
                    } else {
                        notificationsIcon.textContent = '🔕';
                        notificationsLabel.textContent = 'Notificaciones (OFF)';
                    }
                }
            }
        }

        // Initialize dashboard
        const dashboard = new HomeDashboard();

        // Global functions
        function navigateToSection(section) {
            dashboard.navigateToSection(section);
        }

        function quickStart() {
            dashboard.quickStart();
        }

        function showUserMenu() {
            dashboard.showUserMenu();
        }
        
        // User Menu Functions
        function toggleUserMenu() {
            const userProfile = document.getElementById('userProfile');
            const userDropdown = document.getElementById('userDropdown');
            const userMenuOverlay = document.getElementById('userMenuOverlay');
            const header = document.querySelector('.header');
            
            if (userProfile && userDropdown && userMenuOverlay) {
                const isActive = userDropdown.classList.contains('active');
                
                if (isActive) {
                    // Close dropdown
                    userProfile.classList.remove('active');
                    userDropdown.classList.remove('active');
                    userMenuOverlay.classList.remove('active');
                    if (header) header.classList.remove('user-menu-active');
                } else {
                    // Calculate position based on user profile location
                    const profileRect = userProfile.getBoundingClientRect();
                    const viewportWidth = window.innerWidth;
                    const dropdownWidth = 280;
                    
                    // Position dropdown directly below the user profile
                    let leftPosition = profileRect.right - dropdownWidth;
                    let topPosition = profileRect.bottom + 8;
                    
                    // Ensure dropdown doesn't go off screen to the left
                    if (leftPosition < 20) {
                        leftPosition = 20;
                    }
                    
                    // Ensure dropdown doesn't go off screen to the right
                    if (leftPosition + dropdownWidth > viewportWidth - 20) {
                        leftPosition = viewportWidth - dropdownWidth - 20;
                    }
                    
                    // For mobile, center it
                    if (viewportWidth <= 768) {
                        leftPosition = (viewportWidth - dropdownWidth) / 2;
                        if (leftPosition < 20) leftPosition = 20;
                    }
                    
                    userDropdown.style.left = leftPosition + 'px';
                    userDropdown.style.right = 'auto';
                    userDropdown.style.top = topPosition + 'px';
                    
                    // Open dropdown with overlay and bring header to front
                    userProfile.classList.add('active');
                    userDropdown.classList.add('active');
                    userMenuOverlay.classList.add('active');
                    if (header) header.classList.add('user-menu-active');
                    
                    // Update dropdown content with latest data
                    dashboard.updateUserDropdown();
                }
            }
        }
        
        function toggleNotifications() {
            const isEnabled = localStorage.getItem('latanda_notifications_enabled') === 'true';
            
            if (isEnabled) {
                localStorage.setItem('latanda_notifications_enabled', 'false');
                dashboard.showNotification('🔕 Notificaciones Deshabilitadas', 'Ya no recibirás notificaciones push');
            } else {
                localStorage.setItem('latanda_notifications_enabled', 'true');
                dashboard.showNotification('🔔 Notificaciones Habilitadas', 'Recibirás notificaciones de transacciones y actividad');
            }
            
            // Update the notification icon in menu
            setTimeout(() => {
                dashboard.updateUserDropdown();
            }, 100);
            
            toggleUserMenu(); // Close menu after action
        }
        
        function showHelp() {
            // Create help modal
            createHelpModal();
            toggleUserMenu(); // Close menu after action
        }
        
        function createHelpModal() {
            // Remove existing modal if any
            const existingModal = document.getElementById('helpModal');
            if (existingModal) {
                document.body.removeChild(existingModal);
            }
            
            const modal = document.createElement('div');
            modal.id = 'helpModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 15000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: var(--bg-glass);
                    backdrop-filter: blur(24px);
                    border: 2px solid var(--tanda-cyan);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    position: relative;
                    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
                ">
                    <button onclick="closeHelpModal()" style="
                        position: absolute;
                        top: 15px;
                        right: 20px;
                        background: none;
                        border: none;
                        color: var(--text-secondary);
                        font-size: 24px;
                        cursor: pointer;
                        padding: 5px;
                    ">×</button>
                    
                    <h2 style="color: var(--tanda-cyan); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <span>❓</span> Ayuda & Soporte
                    </h2>
                    
                    <div style="color: var(--text-primary); line-height: 1.6;">
                        <h3 style="color: var(--tanda-cyan); margin: 15px 0 10px 0;">🚀 Primeros Pasos:</h3>
                        <ul style="margin-left: 20px;">
                            <li>Completa tu verificación KYC</li>
                            <li>Configura tu wallet Web3</li>
                            <li>Únete a tu primera tanda</li>
                        </ul>
                        
                        <h3 style="color: var(--tanda-cyan); margin: 15px 0 10px 0;">💰 Gestión Financiera:</h3>
                        <ul style="margin-left: 20px;">
                            <li>Ver balance y transacciones</li>
                            <li>Crear o unirse a grupos</li>
                            <li>Trading y staking DeFi</li>
                        </ul>
                        
                        <h3 style="color: var(--tanda-cyan); margin: 15px 0 10px 0;">📞 Contacto:</h3>
                        <p style="margin-left: 20px;">
                            📧 Email: soporte@latanda.com<br>
                            💬 Telegram: @LaTandaSupport<br>
                            🌐 Web: latanda.com/help
                        </p>
                    </div>
                    
                    <div style="text-align: center; margin-top: 25px;">
                        <button onclick="openTutorial()" style="
                            background: linear-gradient(135deg, var(--tanda-cyan), var(--tanda-cyan-light));
                            color: var(--tanda-black);
                            border: none;
                            padding: 12px 24px;
                            border-radius: 12px;
                            font-weight: 600;
                            cursor: pointer;
                            margin-right: 10px;
                        ">🎯 Tutorial Interactivo</button>
                        
                        <button onclick="closeHelpModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: var(--text-primary);
                            border: 1px solid var(--border-primary);
                            padding: 12px 24px;
                            border-radius: 12px;
                            font-weight: 500;
                            cursor: pointer;
                        ">Cerrar</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal on outside click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeHelpModal();
                }
            });
        }
        
        function closeHelpModal() {
            const modal = document.getElementById('helpModal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }
        
        function openTutorial() {
            closeHelpModal();
            dashboard.showNotification('🎯 Tutorial Iniciado', 'Te guiaremos paso a paso por el ecosistema');
            
            // Start interactive tutorial
            setTimeout(() => {
                dashboard.quickStart();
            }, 1000);
        }
        
        function logout() {
            // Show confirmation
            if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
                // Clear all user data
                localStorage.removeItem('latanda_auth_token');
                localStorage.removeItem('latanda_user');
                localStorage.removeItem('latanda_stats');
                sessionStorage.clear();
                
                dashboard.showNotification('Sesión Cerrada', 'Redirigiendo al login...');
                
                // Redirect to login after a short delay
                setTimeout(() => {
                    if (window.parent !== window) {
                        // In iframe - notify parent
                        window.parent.postMessage({
                            type: 'latanda:logout'
                        }, '*');
                    } else {
                        // Direct navigation
                        window.location.href = '/la-tanda-complete.html';
                    }
                }, 2000);
            }
            
            toggleUserMenu(); // Close menu regardless
        }
        
        // Close user menu when clicking outside
        document.addEventListener('click', (event) => {
            const userProfile = document.getElementById('userProfile');
            const userDropdown = document.getElementById('userDropdown');
            const userMenuOverlay = document.getElementById('userMenuOverlay');
            const header = document.querySelector('.header');
            
            if (userProfile && userDropdown && userMenuOverlay && userDropdown.classList.contains('active')) {
                // Check if click is outside the user profile area
                if (!userProfile.contains(event.target)) {
                    userProfile.classList.remove('active');
                    userDropdown.classList.remove('active');
                    userMenuOverlay.classList.remove('active');
                    if (header) header.classList.remove('user-menu-active');
                }
            }
        });
        
        // Close user menu with ESC key
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                const userDropdown = document.getElementById('userDropdown');
                if (userDropdown && userDropdown.classList.contains('active')) {
                    toggleUserMenu();
                }
            }
        });

        // Auto-load check for authentication
        window.addEventListener('load', () => {
            const token = localStorage.getItem('latanda_auth_token');
            if (!token) {
                // Redirect to auth if not authenticated
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'latanda:auth:required'
                    }, '*');
                } else {
                    window.location.href = '/auth-enhanced.html';
                }
            }
        });

        // Sidebar Toggle Functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (sidebar && overlay) {
                const isOpen = sidebar.classList.contains('open');
                
                if (isOpen) {
                    // Close sidebar
                    sidebar.classList.remove('open');
                    overlay.classList.remove('active');
                    document.body.style.overflow = '';
                } else {
                    // Open sidebar
                    sidebar.classList.add('open');
                    overlay.classList.add('active');
                    // Prevent body scroll when sidebar is open on mobile
                    if (window.innerWidth <= 768) {
                        document.body.style.overflow = 'hidden';
                    }
                }
            }
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (event) => {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menuToggle');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (sidebar && sidebar.classList.contains('open')) {
                // Check if click is outside sidebar and not on menu toggle
                if (!sidebar.contains(event.target) && 
                    !menuToggle.contains(event.target) && 
                    !overlay.contains(event.target)) {
                    toggleSidebar();
                }
            }
        });

        // Enhanced Navigation System
        function navigateToSection(section) {
            // Update active navigation item
            updateActiveNavItem(section);
            
            // Close sidebar after navigation (especially on mobile)
            if (window.innerWidth <= 768) {
                setTimeout(() => {
                    toggleSidebar();
                }, 150);
            }
            
            // Close user menu if open
            const userDropdown = document.getElementById('userDropdown');
            if (userDropdown && userDropdown.classList.contains('active')) {
                toggleUserMenu();
            }
            
            // Special handling for different sections
            handleSectionNavigation(section);
            
            // Navigate using the dashboard navigation system
            dashboard.navigateToSection(section);
            
            // Add navigation feedback
            dashboard.showNotification('Navegando...', `Accediendo a ${getSectionTitle(section)}`);
        }
        
        function handleSectionNavigation(section) {
            switch(section) {
                case 'profile':
                    showProfileInfo();
                    break;
                case 'wallet':
                    showWalletInfo();
                    break;
                case 'kyc':
                    showKYCInfo();
                    break;
                case 'security':
                    showSecurityInfo();
                    break;
                case 'settings':
                    showSettingsInfo();
                    break;
                default:
                    // Regular navigation
                    break;
            }
        }
        
        function showProfileInfo() {
            const user = JSON.parse(localStorage.getItem('latanda_user') || '{}');
            const stats = JSON.parse(localStorage.getItem('latanda_stats') || '{}');
            
            dashboard.showNotification('👤 Mi Perfil', `Hola ${user.name || 'Usuario'}! Balance: $${stats.balance?.toFixed(2) || '0.00'}`);
        }
        
        function showWalletInfo() {
            const stats = JSON.parse(localStorage.getItem('latanda_stats') || '{}');
            dashboard.showNotification('💰 Mi Wallet', `Balance actual: $${stats.balance?.toFixed(2) || '0.00'} | Puntos LTD: ${stats.points || 0}`);
        }
        
        function showKYCInfo() {
            const stats = JSON.parse(localStorage.getItem('latanda_stats') || '{}');
            const kycStatus = stats.kyc || 'Pendiente';
            const statusEmoji = kycStatus === 'Verificado' ? '✅' : '⏳';
            dashboard.showNotification('📋 Estado KYC', `${statusEmoji} Estado: ${kycStatus}`);
        }
        
        function showSecurityInfo() {
            dashboard.showNotification('🔒 Seguridad', 'Configuración de seguridad y autenticación de dos factores');
        }
        
        function showSettingsInfo() {
            dashboard.showNotification('⚙️ Configuración', 'Ajustes generales del sistema y preferencias de usuario');
        }

        function updateActiveNavItem(section) {
            // Remove active class from all nav items
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            
            // Add active class to current section
            const activeItem = document.querySelector(`[onclick="navigateToSection('${section}')"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }

        function getSectionTitle(section) {
            const sectionTitles = {
                'home': 'Dashboard',
                'wallet': 'Mi Wallet',
                'transactions': 'Transacciones',
                'groups': 'Mis Grupos',
                'create-group': 'Crear Grupo',
                'invitations': 'Invitaciones',
                'trading': 'Trading',
                'staking': 'Staking',
                'nft': 'NFT Marketplace',
                'dao': 'Governance',
                'profile': 'Mi Perfil',
                'kyc': 'Verificación KYC',
                'security': 'Seguridad',
                'settings': 'Configuración'
            };
            return sectionTitles[section] || section;
        }

        // Responsive behavior
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            
            // Close sidebar on desktop resize
            if (window.innerWidth > 1024 && sidebar && sidebar.classList.contains('open')) {
                toggleSidebar();
            }
            
            // Reset body overflow
            if (window.innerWidth > 768) {
                document.body.style.overflow = '';
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            const sidebar = document.getElementById('sidebar');
            
            // ESC key to close sidebar
            if (event.key === 'Escape' && sidebar && sidebar.classList.contains('open')) {
                toggleSidebar();
            }
            
            // Alt + M to toggle sidebar
            if (event.altKey && event.key === 'm') {
                event.preventDefault();
                toggleSidebar();
            }
        });

        console.log('🏠 La Tanda Home Dashboard loaded');
    </script>
</body>
</html>